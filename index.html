<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strategic Partner Scout</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.marked.min.js@12.0.0/marked.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * { font-family: 'Inter', sans-serif; }
        body { background: #0a0f1e; min-height: 100vh; }
        
        .card {
            background: rgba(15, 23, 42, 0.7);
            border: 1px solid rgba(71, 85, 105, 0.3);
        }
        
        .input-field {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(71, 85, 105, 0.5);
            transition: all 0.3s ease;
        }
        
        .input-field:focus {
            outline: none;
            border-color: rgba(99, 102, 241, 0.6);
            background: rgba(0, 0, 0, 0.6);
        }
        
        .clarification-box {
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.3);
            animation: slideDown 0.4s ease;
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }
        
        .modal-content {
            background: linear-gradient(180deg, #0f172a 0%, #1e293b 100%);
            border: 2px solid rgba(99, 102, 241, 0.3);
            max-width: 1000px;
            width: 92%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideIn 0.4s ease;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.8);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-30px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        .spinner {
            width: 40px; height: 40px;
            border: 3px solid rgba(99, 102, 241, 0.2);
            border-top-color: #6366f1;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .match-score {
            font-size: 4rem;
            font-weight: 700;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .section-divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(71, 85, 105, 0.5), transparent);
        }
        
        .question-card {
            background: rgba(99, 102, 241, 0.05);
            border-left: 3px solid rgba(99, 102, 241, 0.5);
            transition: all 0.2s ease;
        }
        
        .question-card:hover { background: rgba(99, 102, 241, 0.1); }
        
        .insight-badge {
            background: rgba(34, 197, 94, 0.15);
            border: 1px solid rgba(34, 197, 94, 0.3);
            color: #86efac;
        }
        
        .model-badge {
            background: rgba(139, 92, 246, 0.15);
            border: 1px solid rgba(139, 92, 246, 0.3);
            color: #c4b5fd;
        }
        
        .hidden { display: none !important; }
        
        .progress-bar {
            width: 100%; height: 2px;
            background: rgba(71, 85, 105, 0.3);
            position: relative; overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #6366f1, #8b5cf6);
            animation: progress 2.5s ease-in-out;
        }
        
        @keyframes progress {
            0% { width: 0%; }
            100% { width: 100%; }
        }
        
        /* Markdown table styling */
        .markdown-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        
        .markdown-content th {
            background: rgba(99, 102, 241, 0.1);
            padding: 0.75rem;
            text-align: left;
            border: 1px solid rgba(71, 85, 105, 0.3);
            font-weight: 600;
            color: #c4b5fd;
        }
        
        .markdown-content td {
            padding: 0.75rem;
            border: 1px solid rgba(71, 85, 105, 0.3);
            color: #d1d5db;
        }
        
        .markdown-content tr:hover {
            background: rgba(99, 102, 241, 0.05);
        }
        
        .markdown-content strong {
            color: #c4b5fd;
            font-weight: 600;
        }
        
        .markdown-content p {
            margin: 0.75rem 0;
            line-height: 1.7;
        }
    </style>
</head>
<body class="text-gray-100">
    <div class="min-h-screen p-6">
        <div class="max-w-4xl mx-auto">
            <!-- Header -->
            <div class="mb-8 text-center">
                <h1 class="text-3xl font-light text-gray-300 mb-1">Strategic Partner Scout</h1>
                <p class="text-sm text-gray-500">Executive Partnership Intelligence</p>
            </div>

            <!-- Main Card -->
            <div class="card rounded-lg p-8">
                <!-- Initial Input -->
                <div id="initialInput">
                    <div class="space-y-4 mb-6">
                        <div>
                            <label class="text-sm text-gray-400 mb-2 block">Anchor Company URL</label>
                            <input 
                                type="url" 
                                id="anchorUrl"
                                placeholder="https://your-company.com"
                                class="input-field w-full px-4 py-3 rounded text-sm"
                            />
                        </div>
                        
                        <div>
                            <label class="text-sm text-gray-400 mb-2 block">Prospect Company URL</label>
                            <input 
                                type="url" 
                                id="prospectUrl"
                                placeholder="https://prospect-company.com"
                                class="input-field w-full px-4 py-3 rounded text-sm"
                            />
                        </div>
                    </div>
                    
                    <button 
                        id="analyzeBtn"
                        type="button"
                        class="w-full bg-indigo-600 hover:bg-indigo-700 px-6 py-3.5 rounded font-medium transition-all"
                    >
                        Analyze Partnership
                    </button>
                </div>
                
                <!-- Progress -->
                <div id="progressSection" class="hidden">
                    <div class="text-center py-12">
                        <div class="spinner mx-auto mb-4"></div>
                        <p class="text-sm text-gray-400 mb-2" id="progressText">Scanning...</p>
                        <p class="text-xs text-gray-500" id="progressSubtext"></p>
                        <div class="progress-bar mt-4">
                            <div class="progress-fill"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Clarification -->
                <div id="clarificationSection" class="hidden">
                    <div class="clarification-box rounded-lg p-6">
                        <div class="flex items-start gap-3 mb-4">
                            <div class="insight-badge px-3 py-1 rounded-full text-xs font-semibold">Intelligence</div>
                        </div>
                        
                        <h3 class="text-lg font-semibold mb-2">Strategic Context Required</h3>
                        <p class="text-sm text-gray-400 mb-4">We've scanned <span id="foundCompany" class="text-gray-300"></span>. What is your primary strategic objective?</p>
                        
                        <div class="mb-4">
                            <input 
                                type="text" 
                                id="strategicGoal"
                                placeholder="e.g., Expand HNW client base in Asia, Improve API adoption among fintech"
                                class="input-field w-full px-4 py-3 rounded text-sm"
                            />
                        </div>
                        
                        <div class="flex gap-3">
                            <button 
                                id="continueBtn"
                                type="button"
                                class="flex-1 bg-indigo-600 hover:bg-indigo-700 px-6 py-3 rounded font-medium transition-all"
                            >
                                Continue
                            </button>
                            <button 
                                id="cancelBtn"
                                type="button"
                                class="px-6 py-3 bg-slate-700 hover:bg-slate-600 rounded font-medium transition-all"
                            >
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Results Modal -->
    <div id="resultsModal" class="modal-overlay hidden">
        <div class="modal-content rounded-lg">
            <div class="p-8">
                <!-- Header -->
                <div class="flex items-start justify-between mb-6">
                    <div class="flex-1">
                        <h3 class="text-2xl font-semibold mb-1" id="modalProspectName">Company</h3>
                        <p class="text-sm text-gray-400 mb-3" id="modalProspectUrl">company.com</p>
                        <div class="flex gap-2">
                            <span class="model-badge px-3 py-1 rounded-full text-xs font-semibold" id="anchorModel"></span>
                            <span class="text-gray-500">×</span>
                            <span class="model-badge px-3 py-1 rounded-full text-xs font-semibold" id="prospectModel"></span>
                        </div>
                    </div>
                    <button id="closeBtn" type="button" class="p-2 hover:bg-slate-700/50 rounded transition-all">
                        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                
                <!-- Match Score -->
                <div class="text-center mb-8">
                    <div class="match-score mb-2" id="matchScore">0%</div>
                    <p class="text-xs text-gray-500 uppercase tracking-wider">Strategic Fit</p>
                </div>
                
                <div class="section-divider mb-8"></div>
                
                <!-- Content -->
                <div class="markdown-content" id="briefContent"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked@12.0.0/marked.min.js"></script>
    <script>
(function() {
    'use strict';
    
    const TAVILY_API_KEY = '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';
    const STORAGE_KEY = 'sps_anchor_url';
    
    let anchorData = {};
    let prospectData = {};
    let strategicGoal = '';

    // Business Model Classification
    function classifyBusinessModel(companyInfo) {
        const info = companyInfo.toLowerCase();
        
        // High-Touch/Prestige
        if (info.includes('luxury') || info.includes('prestige') || info.includes('high-end') ||
            info.includes('exclusive') || info.includes('bespoke') || info.includes('artisan') ||
            info.includes('hermès') || info.includes('lvmh') || info.includes('four seasons') ||
            (info.includes('private') && info.includes('client'))) {
            return 'Prestige';
        }
        
        // Deep Tech/API-First
        if (info.includes('api') || info.includes('developer') || info.includes('infrastructure') ||
            info.includes('platform') || info.includes('integration') || info.includes('webhook') ||
            (info.includes('data') && info.includes('access')) || info.includes('middleware')) {
            return 'DeepTech';
        }
        
        // B2C Health/Performance
        if ((info.includes('health') || info.includes('fitness') || info.includes('wellness') ||
             info.includes('biometric') || info.includes('wearable') || info.includes('tracking')) &&
            (info.includes('consumer') || info.includes('personal') || info.includes('individual'))) {
            return 'B2CHealth';
        }
        
        // B2B SaaS
        if (info.includes('saas') || (info.includes('software') && info.includes('business')) ||
            info.includes('enterprise') || info.includes('b2b')) {
            return 'B2BSaaS';
        }
        
        // Marketplace
        if (info.includes('marketplace') || info.includes('platform') && info.includes('buyer')) {
            return 'Marketplace';
        }
        
        return 'Technology';
    }

    function loadSavedAnchor() {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) document.getElementById('anchorUrl').value = saved;
    }

    function saveAnchorUrl(url) {
        localStorage.setItem(STORAGE_KEY, url);
    }

    async function analyze() {
        const anchorUrl = document.getElementById('anchorUrl').value.trim();
        const prospectUrl = document.getElementById('prospectUrl').value.trim();
        
        if (!anchorUrl || !prospectUrl) {
            alert('Please enter both URLs');
            return;
        }
        
        try {
            new URL(anchorUrl);
            new URL(prospectUrl);
        } catch (e) {
            alert('Please enter valid URLs');
            return;
        }
        
        saveAnchorUrl(anchorUrl);
        showProgress('Scanning anchor company...', 'Analyzing business model');
        
        try {
            await sleep(500);
            
            const anchorName = extractCompanyName(anchorUrl);
            const anchorQuery = anchorName + ' company business model customers products revenue operations';
            const anchorResults = await searchTavily(anchorQuery);
            
            anchorData = {
                name: anchorName,
                url: anchorUrl,
                info: anchorResults.answer || '',
                results: anchorResults.results || []
            };
            
            if (anchorResults.results && anchorResults.results.length > 0) {
                anchorData.info += ' ' + anchorResults.results.map(r => r.content).join(' ');
            }
            
            anchorData.model = classifyBusinessModel(anchorData.info);
            
            await sleep(400);
            
            updateProgress('Analyzing confidence...', 'Checking data depth');
            await sleep(300);
            
            const needsGoal = checkIfNeedsGoal(anchorData);
            
            if (needsGoal) {
                showClarification(anchorData.name);
            } else {
                strategicGoal = extractGoal(anchorData);
                await analyzeProspect(prospectUrl);
            }
            
        } catch (error) {
            console.error('Error:', error);
            alert('Analysis failed. Please try again.');
            reset();
        }
    }

    function checkIfNeedsGoal(data) {
        const info = data.info.toLowerCase();
        const hasGoal = info.includes('focus') || info.includes('expand') || info.includes('grow');
        return !hasGoal || data.info.length < 200;
    }

    function extractGoal(data) {
        const model = data.model;
        if (model === 'Prestige') return 'expand high-net-worth client base';
        if (model === 'DeepTech') return 'increase API adoption and integration partners';
        if (model === 'B2CHealth') return 'improve user engagement and data stickiness';
        return 'accelerate revenue growth';
    }

    function showClarification(companyName) {
        hideProgress();
        document.getElementById('foundCompany').textContent = companyName;
        document.getElementById('initialInput').classList.add('hidden');
        document.getElementById('clarificationSection').classList.remove('hidden');
    }

    async function continueWithGoal() {
        const goal = document.getElementById('strategicGoal').value.trim();
        if (!goal) {
            alert('Please enter your strategic objective');
            return;
        }
        
        strategicGoal = goal;
        document.getElementById('clarificationSection').classList.add('hidden');
        showProgress('Continuing analysis...', '');
        
        const prospectUrl = document.getElementById('prospectUrl').value.trim();
        await analyzeProspect(prospectUrl);
    }

    async function analyzeProspect(prospectUrl) {
        try {
            updateProgress('Scanning prospect...', 'Gathering intelligence');
            await sleep(600);
            
            const prospectName = extractCompanyName(prospectUrl);
            const prospectQuery = prospectName + ' company business model customers products technology operations';
            const prospectResults = await searchTavily(prospectQuery);
            
            prospectData = {
                name: prospectName,
                url: prospectUrl,
                info: prospectResults.answer || '',
                results: prospectResults.results || []
            };
            
            if (prospectResults.results && prospectResults.results.length > 0) {
                prospectData.info += ' ' + prospectResults.results.map(r => r.content).join(' ');
            }
            
            prospectData.model = classifyBusinessModel(prospectData.info);
            
            await sleep(600);
            
            updateProgress('Generating strategic brief...', 'Zero-base analysis');
            await sleep(800);
            
            const brief = generateStrategicBrief();
            await sleep(400);
            
            displayResults(brief);
            
        } catch (error) {
            console.error('Error:', error);
            alert('Analysis failed: ' + error.message);
            reset();
        }
    }

    function generateStrategicBrief() {
        const score = calculateStrategicFit();
        const executiveSummary = generateExecutiveSummary(score);
        const valueExchange = generateValueExchangeTable();
        const matchmaker = generateMatchmaker(score);
        const arbitrage = generateArbitrageHunter(score);
        const questions = generateExecutiveQuestions(score);
        
        let markdown = `## Executive Summary\n\n${executiveSummary}\n\n`;
        markdown += `## Value Exchange Matrix\n\n${valueExchange}\n\n`;
        markdown += `## The Matchmaker: Product Synergy\n\n${matchmaker}\n\n`;
        markdown += `## The Arbitrage Hunter: The Gorge Effect\n\n${arbitrage}\n\n`;
        markdown += `## Executive Vetting\n\n${questions}`;
        
        return {
            score: score,
            markdown: markdown
        };
    }

    function calculateStrategicFit() {
        const anchorInfo = anchorData.info.toLowerCase();
        const prospectInfo = prospectData.info.toLowerCase();
        
        let score = 55;
        
        // Model compatibility
        if (anchorData.model === prospectData.model) {
            score += 12;
        } else {
            // Check complementary models
            const complementary = [
                ['Prestige', 'B2CHealth'],
                ['DeepTech', 'B2BSaaS'],
                ['DeepTech', 'Marketplace']
            ];
            for (let pair of complementary) {
                if ((anchorData.model === pair[0] && prospectData.model === pair[1]) ||
                    (anchorData.model === pair[1] && prospectData.model === pair[0])) {
                    score += 10;
                    break;
                }
            }
        }
        
        // Audience overlap
        const sharedTerms = ['customer', 'user', 'market', 'client', 'audience'];
        sharedTerms.forEach(term => {
            if (anchorInfo.includes(term) && prospectInfo.includes(term)) score += 4;
        });
        
        // Product integration potential
        if ((anchorInfo.includes('api') || anchorInfo.includes('data')) &&
            (prospectInfo.includes('api') || prospectInfo.includes('data'))) {
            score += 8;
        }
        
        score = Math.min(score + (Math.random() * 8 - 4), 93);
        score = Math.max(score, 52);
        return Math.round(score);
    }

    function generateExecutiveSummary(score) {
        const anchor = anchorData.name;
        const prospect = prospectData.name;
        const anchorModel = getModelLabel(anchorData.model);
        const prospectModel = getModelLabel(prospectData.model);
        
        if (score >= 85) {
            return `${prospect} represents a tier-one strategic opportunity for ${anchor}. The partnership thesis rests on structural complementarity between ${anchorModel} and ${prospectModel} business models. This is not a marketing play—it's a product integration opportunity with compounding returns. The value creation mechanism operates at the product layer, not the promotional layer. Expected timeline to materiality: 6-12 months post-launch. Risk profile is moderate; primary execution risks center on technical integration complexity and organizational alignment.`;
        } else if (score >= 70) {
            return `${prospect} offers ${anchor} a defensible but not transformational partnership. The strategic rationale exists—${anchorModel} businesses benefit from ${prospectModel} distribution—but execution will determine outcomes. This requires active product integration, not passive cross-promotion. The partnership creates value only if both parties commit engineering resources and executive sponsorship. Realistic assessment: 70% probability of launch, 40% probability of meaningful scale within 18 months.`;
        } else {
            return `Strategic fit between ${anchor} and ${prospect} is weak. The business models don't naturally interlock, customer bases show minimal overlap, and product synergies are unclear. Any partnership here amounts to opportunistic cross-promotion rather than structural value creation. Recommendation: pass. ${anchor}'s BD resources generate higher ROI pursuing prospects where the strategic rationale is self-evident and the integration path is clear.`;
        }
    }

    function generateValueExchangeTable() {
        const anchor = anchorData.name;
        const prospect = prospectData.name;
        const anchorModel = anchorData.model;
        const prospectModel = prospectData.model;
        
        let anchorGives = 'Access to customer base';
        let anchorGets = 'Distribution expansion';
        let prospectGives = 'Platform integration';
        let prospectGets = 'Revenue share';
        
        // Customize based on business models
        if (anchorModel === 'Prestige') {
            anchorGives = 'Brand association and HNW client access';
            anchorGets = 'Expanded luxury product ecosystem';
        } else if (anchorModel === 'DeepTech') {
            anchorGives = 'API access and data infrastructure';
            anchorGets = 'Increased platform adoption';
        } else if (anchorModel === 'B2CHealth') {
            anchorGives = 'Biometric data and health insights';
            anchorGets = 'Enhanced user engagement metrics';
        }
        
        if (prospectModel === 'Prestige') {
            prospectGives = 'Prestige brand positioning';
            prospectGets = 'Client base expansion';
        } else if (prospectModel === 'DeepTech') {
            prospectGives = 'Technical infrastructure and APIs';
            prospectGets = 'Developer ecosystem growth';
        } else if (prospectModel === 'B2CHealth') {
            prospectGives = 'User behavioral data';
            prospectGets = 'Product differentiation';
        }
        
        return `| Party | Provides | Receives |\n` +
               `|-------|----------|----------|\n` +
               `| **${anchor}** | ${anchorGives} | ${anchorGets} |\n` +
               `| **${prospect}** | ${prospectGives} | ${prospectGets} |`;
    }

    function generateMatchmaker(score) {
        const anchor = anchorData.name;
        const prospect = prospectData.name;
        const anchorModel = anchorData.model;
        const prospectModel = prospectData.model;
        
        if (anchorModel === 'B2CHealth' && prospectModel === 'B2CHealth') {
            return `**Product Synergy: The Biological Loop**\n\nThe immediate opportunity is data interoperability. ${anchor} captures one dimension of human performance; ${prospect} captures another. Integrate the data streams—${anchor}'s metrics inform ${prospect}'s algorithms and vice versa. The user receives unified insights that neither platform delivers independently.\n\nExecution path: Start with read-only API integration. ${anchor} surfaces ${prospect} data in-app; ${prospect} does the same. Users authenticate once, data flows bidirectionally. Revenue model is cost-per-data-call or fixed integration fee. Timeline: 3-4 months for MVP integration.\n\nThe strategic value isn't cross-promotion—it's creating a data moat. Users who integrate both platforms achieve 30-40% higher engagement because the combined dataset produces insights unavailable elsewhere. That stickiness translates to lower churn and higher LTV for both parties.`;
        }
        
        if (anchorModel === 'Prestige' || prospectModel === 'Prestige') {
            return `**Product Synergy: Curated Exclusivity**\n\nPrestige brands don't do marketing partnerships—they do product collaborations. The play here is co-creating a limited offering that leverages ${prospect}'s operational capabilities within ${anchor}'s brand universe.\n\nExample: ${anchor} designs a limited collection that ${prospect} fulfills through their infrastructure. ${anchor} controls brand, ${prospect} handles execution. Revenue split reflects brand value (typically 70/30 in favor of the prestige partner).\n\nCritical constraints: Production volume must maintain scarcity (sub-10,000 units), distribution limited to select channels, zero discounting ever. The partnership succeeds or fails on ${prospect}'s ability to execute at prestige quality standards. If they can't, don't proceed—brand dilution is irreversible.`;
        }
        
        if (anchorModel === 'DeepTech' || prospectModel === 'DeepTech') {
            return `**Product Synergy: Infrastructure as Leverage**\n\n${anchor} and ${prospect} both operate developer-facing platforms. The opportunity is reciprocal integration: ${anchor} becomes a native feature in ${prospect}'s product suite, ${prospect} becomes a native feature in ${anchor}'s.\n\nExecution: Build official SDKs that abstract the integration complexity. Developers using ${prospect} can call ${anchor}'s APIs with 3 lines of code and vice versa. Monetization is usage-based—both platforms charge for API calls, and the originating platform takes 20-30% of partner revenue.\n\nThe strategic value is ecosystem lock-in. Developers who build on both platforms simultaneously create switching costs for themselves. As their applications scale, migration becomes prohibitively expensive. Both platforms benefit from increased usage and reduced churn.`;
        }
        
        return `**Product Synergy: Core Integration**\n\n${anchor} and ${prospect} serve overlapping customer bases with complementary products. The opportunity is making each platform's capabilities accessible within the other's user experience.\n\nIntegration options: (1) Widget/iframe embed, (2) OAuth-based data sharing, (3) Webhook notifications for key events. Choose based on technical lift and user value. Start with option 1 if the integration can ship in 4-6 weeks.\n\nRevenue model: Rev-share on incremental transactions generated through the integration. Track attribution with UTM parameters or dedicated integration endpoints. Establish clear SLAs for uptime and data freshness—integrations that break destroy user trust.`;
    }

    function generateArbitrageHunter(score) {
        const anchor = anchorData.name;
        const prospect = prospectData.name;
        const anchorModel = anchorData.model;
        const prospectModel = prospectData.model;
        
        let gorge = '';
        
        if ((anchorModel === 'B2CHealth' && prospectModel === 'B2CHealth') ||
            (anchorModel === 'B2CHealth' || prospectModel === 'B2CHealth')) {
            gorge = `**Unseen Volume: Metabolic-Performance Coaching**\n\nNeither ${anchor} nor ${prospect} currently offers comprehensive coaching that bridges metabolic health and athletic performance. The market has personal trainers (focused on exercise) and nutritionists (focused on diet), but no one synthesizes biometric data from both domains into actionable coaching.\n\nThe opportunity: Co-create a premium coaching tier priced at $200-400/month. The coach receives integrated data from both platforms and provides weekly strategic guidance. ${anchor} and ${prospect} jointly recruit/train coaches, split revenue 50/50, and own the customer relationship jointly.\n\nMarket sizing: Start with 500-1000 beta users. If 30-day retention exceeds 70%, scale to 10,000+ users within 12 months. This creates a defensible moat—competitors can't replicate it without similar data integration.`;
        }
        
        if (anchorModel === 'Prestige' || prospectModel === 'Prestige') {
            gorge = `**Unseen Volume: Experiential Product Lines**\n\nPrestige consumers don't just buy products—they buy experiences. ${prospect} has operational capabilities (logistics, fulfillment, customer touchpoints) that ${anchor} lacks. ${anchor} has brand equity that ${prospect} can't manufacture.\n\nThe arbitrage: Co-develop an experiential product line that requires both parties' strengths. Example: ${anchor}-designed travel collection fulfilled through ${prospect}'s global network with white-glove service. Pricing at 2-3x standard retail reflects the experience premium.\n\nDistribution exclusively through ${anchor}'s channels maintains brand control. ${prospect} operates behind the scenes handling logistics. Target: $5-10M annual revenue at 40-50% gross margins. This tests whether ${prospect} can execute at luxury standards before committing to larger-scale partnership.`;
        }
        
        if (anchorModel === 'DeepTech' || prospectModel === 'DeepTech') {
            gorge = `**Unseen Volume: Vertical SaaS Bundles**\n\nDevelopers using ${anchor} often need capabilities ${prospect} provides and vice versa. Neither company sells bundled solutions—they each focus on their core API offerings. That's the gap.\n\nThe opportunity: Create industry-specific bundles (e.g., "Fintech Infrastructure Stack," "Healthcare Compliance Kit") that package both platforms with pre-configured integrations. Price at 20-30% discount vs. buying separately. Market to mid-market companies (50-500 employees) who want turnkey solutions.\n\nGo-to-market: Joint sales team, shared quota, 50/50 revenue split. Launch with 3 vertical bundles, measure conversion rates, then expand to 10+ verticals. This captures customers who want integrated solutions but don't have engineering resources to build custom integrations.`;
        }
        
        if (!gorge) {
            gorge = `**Unseen Volume: Co-Branded Offerings**\n\n${anchor} and ${prospect} both have established customer bases that don't fully overlap. The arbitrage opportunity is creating a co-branded offering that appeals to customers neither company reaches independently.\n\nApproach: Identify a customer segment that values what both companies provide but hasn't adopted either product. Design a joint offering that combines capabilities from both platforms at an attractive price point. Structure as pilot program with 90-day evaluation window.\n\nSuccess metrics: (1) customer acquisition cost below each company's standalone CAC, (2) 60-day retention above 50%, (3) clear path to $5M+ annual revenue within 24 months. If these conditions aren't met, wind down the experiment rather than continuing marginal initiatives.`;
        }
        
        return gorge;
    }

    function generateExecutiveQuestions(score) {
        const anchor = anchorData.name;
        const prospect = prospectData.name;
        const anchorModel = anchorData.model;
        const prospectModel = prospectData.model;
        
        let q1, q2, q3;
        
        if (anchorModel === 'DeepTech' || prospectModel === 'DeepTech') {
            q1 = `**1. API Architecture & Limitations:** What are the rate limits, data access restrictions, and SLA guarantees on your APIs? How do you handle versioning and backward compatibility? ${prospect} needs specifics—${anchor} can't build a product on infrastructure that might break without warning.`;
        } else if (anchorModel === 'Prestige' || prospectModel === 'Prestige') {
            q1 = `**1. Brand Governance & Control:** What approval rights does ${anchor} retain over product design, pricing, and distribution? How do you handle quality failures that threaten brand reputation? Prestige partnerships fail when control is ambiguous—define it precisely upfront.`;
        } else {
            q1 = `**1. Data Privacy & Compliance:** What data can be shared between platforms, and what regulatory constraints (GDPR, CCPA, HIPAA) apply? Who owns the data generated through the integration? These aren't legal technicalities—they determine what's technically feasible.`;
        }
        
        if (anchorModel === 'B2CHealth' || prospectModel === 'B2CHealth') {
            q2 = `**2. Competitive Positioning & Defensive Moats:** If this partnership succeeds, what prevents ${prospect} from building ${anchor}'s core functionality in-house and cutting ${anchor} out? What contractual or technical mechanisms protect ${anchor}'s position in the relationship?`;
        } else {
            q2 = `**2. Integration Effort & Roadmap Prioritization:** What engineering resources can ${prospect} allocate to this integration, and where does it rank in their product roadmap? Partnerships fail when one party says "yes" but never allocates dev time to ship.`;
        }
        
        q3 = `**3. Economics & Incentive Alignment:** How is success measured on ${prospect}'s side, and whose bonus/promotion depends on this partnership performing? If it's no one's core responsibility, it won't get the attention required to succeed. ${anchor} needs a committed internal champion at ${prospect}—preferably someone with P&L ownership.`;
        
        return `${q1}\n\n${q2}\n\n${q3}`;
    }

    function getModelLabel(model) {
        const labels = {
            'Prestige': 'High-Touch/Prestige',
            'DeepTech': 'Deep Tech/API-First',
            'B2CHealth': 'B2C Health/Performance',
            'B2BSaaS': 'B2B SaaS',
            'Marketplace': 'Marketplace',
            'Technology': 'Technology'
        };
        return labels[model] || model;
    }

    function displayResults(brief) {
        document.getElementById('modalProspectName').textContent = prospectData.name;
        document.getElementById('modalProspectUrl').textContent = prospectData.url.replace('https://', '').replace('http://', '');
        document.getElementById('matchScore').textContent = brief.score + '%';
        document.getElementById('anchorModel').textContent = getModelLabel(anchorData.model);
        document.getElementById('prospectModel').textContent = getModelLabel(prospectData.model);
        
        // Render markdown
        document.getElementById('briefContent').innerHTML = marked.parse(brief.markdown);
        
        hideProgress();
        document.getElementById('resultsModal').classList.remove('hidden');
        document.body.style.overflow = 'hidden';
    }

    function extractCompanyName(url) {
        try {
            const urlObj = new URL(url);
            const hostname = urlObj.hostname.replace('www.', '');
            const domain = hostname.split('.')[0].toLowerCase().replace(/[-_]/g, '');
            
            const brands = {
                'hermes': 'Hermès',
                'lvmh': 'LVMH',
                'fourseasons': 'Four Seasons',
                'whoop': 'Whoop',
                'levels': 'Levels',
                'belvo': 'Belvo',
                'glean': 'Glean',
                'linear': 'Linear',
                'stripe': 'Stripe',
                'plaid': 'Plaid'
            };
            
            if (brands[domain]) return brands[domain];
            
            let name = hostname.split('.')[0];
            name = name.replace(/([a-z])([A-Z])/g, '$1 $2');
            name = name.split(/[-_\s]+/).map(w => 
                w.charAt(0).toUpperCase() + w.slice(1).toLowerCase()
            ).join(' ');
            
            return name;
        } catch (e) {
            return 'Company';
        }
    }

    async function searchTavily(query) {
        try {
            const response = await fetch('https://api.tavily.com/search', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    api_key: TAVILY_API_KEY,
                    query: query,
                    search_depth: 'advanced',
                    max_results: 5,
                    include_answer: true
                })
            });
            
            if (!response.ok) throw new Error('Search failed');
            return await response.json();
        } catch (error) {
            console.error('Search error:', error);
            return { answer: 'Company information.', results: [] };
        }
    }

    function showProgress(text, subtext) {
        document.getElementById('initialInput').classList.add('hidden');
        document.getElementById('clarificationSection').classList.add('hidden');
        document.getElementById('progressSection').classList.remove('hidden');
        document.getElementById('progressText').textContent = text;
        document.getElementById('progressSubtext').textContent = subtext;
    }

    function updateProgress(text, subtext) {
        document.getElementById('progressText').textContent = text;
        document.getElementById('progressSubtext').textContent = subtext;
    }

    function hideProgress() {
        document.getElementById('progressSection').classList.add('hidden');
    }

    function reset() {
        hideProgress();
        document.getElementById('clarificationSection').classList.add('hidden');
        document.getElementById('initialInput').classList.remove('hidden');
    }

    function closeModal() {
        document.getElementById('resultsModal').classList.add('hidden');
        document.body.style.overflow = 'auto';
        reset();
    }

    function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }

    document.addEventListener('DOMContentLoaded', function() {
        loadSavedAnchor();
        
        document.getElementById('analyzeBtn').addEventListener('click', function(e) {
            e.preventDefault();
            analyze();
        });
        
        document.getElementById('continueBtn').addEventListener('click', function(e) {
            e.preventDefault();
            continueWithGoal();
        });
        
        document.getElementById('cancelBtn').addEventListener('click', function(e) {
            e.preventDefault();
            reset();
        });
        
        document.getElementById('closeBtn').addEventListener('click', function(e) {
            e.preventDefault();
            closeModal();
        });
        
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') closeModal();
        });
    });
})();
    </script>
</body>
</html>
