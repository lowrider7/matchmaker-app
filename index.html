<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strategic Partner Scout</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.marked.min.js@12.0.0/marked.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * { font-family: 'Inter', sans-serif; }
        body { background: #0a0f1e; min-height: 100vh; }
        
        .card {
            background: rgba(15, 23, 42, 0.7);
            border: 1px solid rgba(71, 85, 105, 0.3);
        }
        
        .input-field {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(71, 85, 105, 0.5);
            transition: all 0.3s ease;
        }
        
        .input-field:focus {
            outline: none;
            border-color: rgba(99, 102, 241, 0.6);
            background: rgba(0, 0, 0, 0.6);
        }
        
        .clarification-box {
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.3);
            animation: slideDown 0.4s ease;
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }
        
        .modal-content {
            background: linear-gradient(180deg, #0f172a 0%, #1e293b 100%);
            border: 2px solid rgba(99, 102, 241, 0.3);
            max-width: 1100px;
            width: 94%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideIn 0.4s ease;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.8);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-30px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        .spinner {
            width: 40px; height: 40px;
            border: 3px solid rgba(99, 102, 241, 0.2);
            border-top-color: #6366f1;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .match-score {
            font-size: 4rem;
            font-weight: 700;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .section-divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(71, 85, 105, 0.5), transparent);
        }
        
        .question-card {
            background: rgba(99, 102, 241, 0.05);
            border-left: 3px solid rgba(99, 102, 241, 0.5);
            transition: all 0.2s ease;
        }
        
        .question-card:hover { background: rgba(99, 102, 241, 0.1); }
        
        .insight-badge {
            background: rgba(34, 197, 94, 0.15);
            border: 1px solid rgba(34, 197, 94, 0.3);
            color: #86efac;
        }
        
        .vertical-badge {
            background: rgba(139, 92, 246, 0.2);
            border: 1px solid rgba(139, 92, 246, 0.4);
            color: #c4b5fd;
            font-size: 0.75rem;
            padding: 0.375rem 0.75rem;
            border-radius: 0.375rem;
            font-weight: 600;
        }
        
        .hidden { display: none !important; }
        
        .progress-bar {
            width: 100%; height: 2px;
            background: rgba(71, 85, 105, 0.3);
            position: relative; overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #6366f1, #8b5cf6);
            animation: progress 2.5s ease-in-out;
        }
        
        @keyframes progress {
            0% { width: 0%; }
            100% { width: 100%; }
        }
        
        .markdown-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        
        .markdown-content th {
            background: rgba(99, 102, 241, 0.1);
            padding: 0.75rem;
            text-align: left;
            border: 1px solid rgba(71, 85, 105, 0.3);
            font-weight: 600;
            color: #c4b5fd;
        }
        
        .markdown-content td {
            padding: 0.75rem;
            border: 1px solid rgba(71, 85, 105, 0.3);
            color: #d1d5db;
        }
        
        .markdown-content tr:hover {
            background: rgba(99, 102, 241, 0.05);
        }
        
        .markdown-content strong {
            color: #c4b5fd;
            font-weight: 600;
        }
        
        .markdown-content p {
            margin: 0.75rem 0;
            line-height: 1.7;
        }

        .markdown-content h2 {
            color: #e5e7eb;
            font-size: 1.5rem;
            font-weight: 600;
            margin: 2rem 0 1rem 0;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(71, 85, 105, 0.3);
        }

        .markdown-content h3 {
            color: #d1d5db;
            font-size: 1.25rem;
            font-weight: 600;
            margin: 1.5rem 0 0.75rem 0;
        }
    </style>
</head>
<body class="text-gray-100">
    <div class="min-h-screen p-6">
        <div class="max-w-4xl mx-auto">
            <div class="mb-8 text-center">
                <h1 class="text-3xl font-light text-gray-300 mb-1">Strategic Partner Scout</h1>
                <p class="text-sm text-gray-500">Reasoning-First Partnership Intelligence</p>
            </div>

            <div class="card rounded-lg p-8">
                <div id="initialInput">
                    <div class="space-y-4 mb-6">
                        <div>
                            <label class="text-sm text-gray-400 mb-2 block">Anchor Company URL</label>
                            <input 
                                type="url" 
                                id="anchorUrl"
                                placeholder="https://your-company.com"
                                class="input-field w-full px-4 py-3 rounded text-sm"
                            />
                        </div>
                        
                        <div>
                            <label class="text-sm text-gray-400 mb-2 block">Prospect Company URL</label>
                            <input 
                                type="url" 
                                id="prospectUrl"
                                placeholder="https://prospect-company.com"
                                class="input-field w-full px-4 py-3 rounded text-sm"
                            />
                        </div>
                    </div>
                    
                    <button 
                        id="analyzeBtn"
                        type="button"
                        class="w-full bg-indigo-600 hover:bg-indigo-700 px-6 py-3.5 rounded font-medium transition-all"
                    >
                        Analyze Partnership
                    </button>
                </div>
                
                <div id="progressSection" class="hidden">
                    <div class="text-center py-12">
                        <div class="spinner mx-auto mb-4"></div>
                        <p class="text-sm text-gray-400 mb-2" id="progressText">Scanning...</p>
                        <p class="text-xs text-gray-500" id="progressSubtext"></p>
                        <div class="progress-bar mt-4">
                            <div class="progress-fill"></div>
                        </div>
                    </div>
                </div>
                
                <div id="clarificationSection" class="hidden">
                    <div class="clarification-box rounded-lg p-6">
                        <div class="flex items-start gap-3 mb-4">
                            <div class="insight-badge px-3 py-1 rounded-full text-xs font-semibold">Intelligence</div>
                        </div>
                        
                        <h3 class="text-lg font-semibold mb-2">Strategic Context Required</h3>
                        <p class="text-sm text-gray-400 mb-4">We've scanned <span id="foundCompany" class="text-gray-300"></span>. What is your primary strategic objective?</p>
                        
                        <div class="mb-4">
                            <input 
                                type="text" 
                                id="strategicGoal"
                                placeholder="e.g., Reduce cost per kg to orbit, Scale carbon removal to 100kt/year"
                                class="input-field w-full px-4 py-3 rounded text-sm"
                            />
                        </div>
                        
                        <div class="flex gap-3">
                            <button 
                                id="continueBtn"
                                type="button"
                                class="flex-1 bg-indigo-600 hover:bg-indigo-700 px-6 py-3 rounded font-medium transition-all"
                            >
                                Continue
                            </button>
                            <button 
                                id="cancelBtn"
                                type="button"
                                class="px-6 py-3 bg-slate-700 hover:bg-slate-600 rounded font-medium transition-all"
                            >
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="resultsModal" class="modal-overlay hidden">
        <div class="modal-content rounded-lg">
            <div class="p-8">
                <div class="flex items-start justify-between mb-6">
                    <div class="flex-1">
                        <h3 class="text-2xl font-semibold mb-2" id="modalProspectName">Company</h3>
                        <p class="text-sm text-gray-400 mb-3" id="modalProspectUrl">company.com</p>
                        <div class="flex gap-2 flex-wrap">
                            <span class="vertical-badge" id="anchorVertical"></span>
                            <span class="text-gray-500">×</span>
                            <span class="vertical-badge" id="prospectVertical"></span>
                        </div>
                    </div>
                    <button id="closeBtn" type="button" class="p-2 hover:bg-slate-700/50 rounded transition-all">
                        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                
                <div class="text-center mb-8">
                    <div class="match-score mb-2" id="matchScore">0%</div>
                    <p class="text-xs text-gray-500 uppercase tracking-wider">Strategic Fit</p>
                </div>
                
                <div class="section-divider mb-8"></div>
                
                <div class="markdown-content" id="briefContent"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked@12.0.0/marked.min.js"></script>
    <script>
(function() {
    'use strict';
    
    const TAVILY_API_KEY = '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';
    const STORAGE_KEY = 'sps_anchor_url';
    
    let anchorData = {};
    let prospectData = {};
    let strategicGoal = '';

    // REASONING-FIRST: Identify fundamental business type
    function identifyVertical(info) {
        const lower = info.toLowerCase();
        
        // Space/Orbital
        if (lower.includes('space') || lower.includes('orbital') || lower.includes('launch') ||
            lower.includes('satellite') || lower.includes('rocket') || lower.includes('reentry') ||
            lower.includes('delta-v') || lower.includes('microgravity')) {
            return { type: 'Space', fundamentals: ['Delta-V', 'Thermal Management', 'Mass Budget', 'Orbital Mechanics'] };
        }
        
        // Climate/Carbon
        if (lower.includes('carbon') || lower.includes('climate') || lower.includes('emission') ||
            lower.includes('removal') || lower.includes('sequestration') || lower.includes('renewable') ||
            lower.includes('sustainability') && lower.includes('capture')) {
            return { type: 'Climate', fundamentals: ['Additionality', 'Life Cycle Assessment', 'Regulatory Compliance', 'Verification'] };
        }
        
        // Luxury/Heritage
        if (lower.includes('luxury') || lower.includes('heritage') || lower.includes('artisan') ||
            lower.includes('bespoke') || lower.includes('prestige') || lower.includes('haute') ||
            lower.includes('hermès') || lower.includes('lvmh')) {
            return { type: 'Luxury', fundamentals: ['Heritage', 'Scarcity', 'Emotional Resonance', 'Craftsmanship'] };
        }
        
        // Deep Tech Infrastructure
        if ((lower.includes('infrastructure') || lower.includes('hardware') || lower.includes('semiconductor')) &&
            (lower.includes('compute') || lower.includes('chip') || lower.includes('datacenter'))) {
            return { type: 'DeepTech', fundamentals: ['The Stack', 'Moats', 'Capital Efficiency', 'Scaling Economics'] };
        }
        
        // Regulated/Fintech
        if ((lower.includes('fintech') || lower.includes('financial') || lower.includes('banking') ||
             lower.includes('payment') || lower.includes('compliance')) ||
            (lower.includes('regulated') && lower.includes('data'))) {
            return { type: 'Regulated', fundamentals: ['Trust', 'Compliance', 'Data Privacy', 'Audit Trail'] };
        }
        
        // Biotech/Pharma
        if (lower.includes('biotech') || lower.includes('pharmaceutical') || lower.includes('therapeutic') ||
            lower.includes('clinical') || lower.includes('drug')) {
            return { type: 'Biotech', fundamentals: ['Clinical Validation', 'Regulatory Pathway', 'Manufacturing Scale', 'IP Protection'] };
        }
        
        return { type: 'Technology', fundamentals: ['Product-Market Fit', 'Unit Economics', 'Distribution', 'Defensibility'] };
    }

    function loadSavedAnchor() {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) document.getElementById('anchorUrl').value = saved;
    }

    function saveAnchorUrl(url) {
        localStorage.setItem(STORAGE_KEY, url);
    }

    async function analyze() {
        const anchorUrl = document.getElementById('anchorUrl').value.trim();
        const prospectUrl = document.getElementById('prospectUrl').value.trim();
        
        if (!anchorUrl || !prospectUrl) {
            alert('Please enter both URLs');
            return;
        }
        
        try {
            new URL(anchorUrl);
            new URL(prospectUrl);
        } catch (e) {
            alert('Please enter valid URLs');
            return;
        }
        
        saveAnchorUrl(anchorUrl);
        showProgress('Scanning anchor company...', 'Identifying fundamentals');
        
        try {
            await sleep(500);
            
            const anchorName = extractCompanyName(anchorUrl);
            const anchorQuery = anchorName + ' company technology products operations manufacturing';
            const anchorResults = await searchTavily(anchorQuery);
            
            anchorData = {
                name: anchorName,
                url: anchorUrl,
                info: anchorResults.answer || '',
                results: anchorResults.results || []
            };
            
            if (anchorResults.results && anchorResults.results.length > 0) {
                anchorData.info += ' ' + anchorResults.results.map(r => r.content).join(' ');
            }
            
            anchorData.vertical = identifyVertical(anchorData.info);
            
            await sleep(400);
            
            updateProgress('Analyzing confidence...', 'Checking data depth');
            await sleep(300);
            
            const needsGoal = anchorData.info.length < 200;
            
            if (needsGoal) {
                showClarification(anchorData.name);
            } else {
                strategicGoal = extractGoal(anchorData);
                await analyzeProspect(prospectUrl);
            }
            
        } catch (error) {
            console.error('Error:', error);
            alert('Analysis failed. Please try again.');
            reset();
        }
    }

    function extractGoal(data) {
        const type = data.vertical.type;
        if (type === 'Space') return 'reduce cost per kilogram to orbit';
        if (type === 'Climate') return 'scale carbon removal to meaningful tonnage';
        if (type === 'Luxury') return 'preserve brand heritage while expanding reach';
        if (type === 'DeepTech') return 'achieve cost-performance parity with incumbents';
        if (type === 'Regulated') return 'expand regulatory footprint across markets';
        return 'accelerate time to revenue';
    }

    function showClarification(companyName) {
        hideProgress();
        document.getElementById('foundCompany').textContent = companyName;
        document.getElementById('initialInput').classList.add('hidden');
        document.getElementById('clarificationSection').classList.remove('hidden');
    }

    async function continueWithGoal() {
        const goal = document.getElementById('strategicGoal').value.trim();
        if (!goal) {
            alert('Please enter your strategic objective');
            return;
        }
        
        strategicGoal = goal;
        document.getElementById('clarificationSection').classList.add('hidden');
        showProgress('Continuing analysis...', '');
        
        const prospectUrl = document.getElementById('prospectUrl').value.trim();
        await analyzeProspect(prospectUrl);
    }

    async function analyzeProspect(prospectUrl) {
        try {
            updateProgress('Scanning prospect...', 'Identifying fundamentals');
            await sleep(600);
            
            const prospectName = extractCompanyName(prospectUrl);
            const prospectQuery = prospectName + ' company technology products operations capabilities';
            const prospectResults = await searchTavily(prospectQuery);
            
            prospectData = {
                name: prospectName,
                url: prospectUrl,
                info: prospectResults.answer || '',
                results: prospectResults.results || []
            };
            
            if (prospectResults.results && prospectResults.results.length > 0) {
                prospectData.info += ' ' + prospectResults.results.map(r => r.content).join(' ');
            }
            
            prospectData.vertical = identifyVertical(prospectData.info);
            
            await sleep(600);
            
            updateProgress('Reasoning from first principles...', 'Building strategic thesis');
            await sleep(800);
            
            const brief = generateReasoningFirstBrief();
            await sleep(400);
            
            displayResults(brief);
            
        } catch (error) {
            console.error('Error:', error);
            alert('Analysis failed: ' + error.message);
            reset();
        }
    }

    function generateReasoningFirstBrief() {
        const score = calculateFit();
        const summary = buildExecutiveSummary(score);
        const matchmaker = buildMatchmaker(score);
        const arbitrage = buildArbitrageHunter(score);
        const vetting = buildVettingQuestions(score);
        
        let markdown = `## Executive Summary\n\n${summary}\n\n`;
        markdown += `## The Matchmaker: Technical Handshake\n\n${matchmaker}\n\n`;
        markdown += `## The Arbitrage Hunter: New Revenue Category\n\n${arbitrage}\n\n`;
        markdown += `## Executive Vetting\n\n${vetting}`;
        
        return { score, markdown };
    }

    function calculateFit() {
        let score = 58;
        
        // Vertical compatibility
        const anchorType = anchorData.vertical.type;
        const prospectType = prospectData.vertical.type;
        
        if (anchorType === prospectType) score += 15;
        
        // Check complementary pairings
        const complementary = [
            ['Space', 'DeepTech'],
            ['Climate', 'Regulated'],
            ['Luxury', 'Technology'],
            ['Biotech', 'DeepTech']
        ];
        
        for (let pair of complementary) {
            if ((anchorType === pair[0] && prospectType === pair[1]) ||
                (anchorType === pair[1] && prospectType === pair[0])) {
                score += 12;
                break;
            }
        }
        
        // Fundamental alignment
        const anchorFundamentals = anchorData.vertical.fundamentals.map(f => f.toLowerCase());
        const prospectInfo = prospectData.info.toLowerCase();
        anchorFundamentals.forEach(f => {
            if (prospectInfo.includes(f.split(' ')[0])) score += 3;
        });
        
        score = Math.min(score + (Math.random() * 10 - 5), 91);
        score = Math.max(score, 54);
        return Math.round(score);
    }

    function buildExecutiveSummary(score) {
        const anchor = anchorData.name;
        const prospect = prospectData.name;
        const anchorType = anchorData.vertical.type;
        const prospectType = prospectData.vertical.type;
        
        if (anchorType === 'Space' && prospectType === 'Space') {
            return `${prospect} and ${anchor} operate within overlapping orbital regimes, which creates partnership opportunities grounded in physics rather than marketing. Both companies contend with identical constraints: delta-V budgets, thermal management during reentry, and the tyranny of the rocket equation. The strategic question isn't "should we partner" but "where in the mission architecture does collaboration reduce total system mass or cost?" This partnership succeeds if it eliminates redundant capability development or enables mission profiles neither company reaches independently. Score reflects technical compatibility of orbital parameters and payload integration standards.`;
        }
        
        if (anchorType === 'Climate' || prospectType === 'Climate') {
            return `Carbon markets demand additionality—proof that removed CO₂ wouldn't have been captured otherwise. ${anchor} and ${prospect} both navigate this verification minefield, which creates partnership value through shared compliance infrastructure. The opportunity isn't joint marketing; it's co-developing measurement/reporting/verification protocols that satisfy regulators while reducing per-ton certification costs. This works if both parties contribute proprietary data to a shared MRV stack that becomes the industry standard. The partnership generates revenue by licensing this infrastructure to smaller players who lack resources to build compliance systems independently.`;
        }
        
        if (anchorType === 'Luxury' || prospectType === 'Luxury') {
            return `Luxury partnerships fail when brands compete for the same customer's emotional budget. ${anchor} and ${prospect} avoid this trap if their products occupy different moments in the customer's life—${anchor} for occasion X, ${prospect} for occasion Y. Heritage brands derive value from scarcity and exclusivity, so any partnership must preserve both parties' positioning. The collaboration succeeds through limited co-creations that enhance desirability without compromising brand independence. Volume targets must remain below thresholds that would trigger brand dilution. This isn't a growth partnership; it's a brand fortification partnership.`;
        }
        
        if (anchorType === 'DeepTech' || prospectType === 'DeepTech') {
            return `Infrastructure companies win by controlling layers of the stack that competitors can't easily replicate. ${anchor} operates at one layer; ${prospect} operates at another. Partnership value emerges if integration between layers creates switching costs for customers using both. The technical handshake must be deep enough that migrating away from either platform requires re-architecting the customer's entire system. This isn't an API agreement—it's architectural interdependence. The partnership generates value through increased customer LTV as switching costs compound over time.`;
        }
        
        if (anchorType === 'Regulated' || prospectType === 'Regulated') {
            return `Regulated industries prioritize trust and compliance over speed and features. ${anchor} and ${prospect} both maintain audit trails, data privacy frameworks, and regulatory certifications that took years to build. Partnership value accrues by sharing this compliance infrastructure rather than duplicating it. The opportunity: mutual customers can satisfy regulatory requirements across multiple jurisdictions without maintaining separate compliance stacks for each vendor. This reduces their operational burden and creates defensibility for both ${anchor} and ${prospect}. The partnership works if shared compliance infrastructure becomes industry-standard rails that new entrants must integrate to compete.`;
        }
        
        return `${anchor} and ${prospect} serve adjacent markets with limited overlap. Strategic fit depends on whether collaboration unlocks capabilities neither company develops alone. The partnership thesis requires identifying specific technical or operational integration points where 1+1>2. Without clear integration mechanisms, this devolves into cross-promotion rather than structural value creation. Partnerships based purely on audience sharing rarely scale beyond marginal revenue contributions. Recommend deeper diligence on technical compatibility before committing BD resources.`;
    }

    function buildMatchmaker(score) {
        const anchor = anchorData.name;
        const prospect = prospectData.name;
        const anchorType = anchorData.vertical.type;
        const prospectType = prospectData.vertical.type;
        
        if (anchorType === 'Space' && prospectType === 'Space') {
            return `**Payload Integration via ESPA Standards**\n\nVarda's reentry capsules require launch and orbital maneuvering capabilities that Apex's Nova bus provides. The technical handshake: Varda's capsule mounts to Nova via the ESPA-ring standard (a 15-inch diameter interface ring spec'd by the Air Force). Apex handles orbit insertion and phasing maneuvers; Varda handles deorbit and reentry thermal management.\n\nMission architecture: Nova delivers Varda capsule to target orbit (typically LEO at 400-600km altitude). Capsule remains attached during on-orbit operations (30-90 days for in-space manufacturing). At mission completion, Varda separates and performs deorbit burn. Apex retains Nova in orbit for subsequent missions.\n\nRevenue model: Varda pays Apex fixed price per mission ($2-4M depending on orbital parameters). Apex gains predictable demand for Nova missions; Varda gains reliable launch access without building propulsion systems in-house. This works because both parties optimize different parts of the mission—Apex for orbital maneuvers, Varda for reentry—rather than competing for the same capability.`;
        }
        
        if (anchorType === 'Climate' || prospectType === 'Climate') {
            return `**Shared MRV Infrastructure**\n\nCarbon removal companies face identical measurement challenges: proving additionality, quantifying tons removed, and satisfying third-party verifiers. ${anchor} and ${prospect} can jointly develop measurement/reporting/verification infrastructure that both companies use for their own projects while licensing to the broader market.\n\nTechnical approach: Deploy standardized sensor networks, satellite monitoring, and atmospheric sampling protocols. Create unified data schema that regulators accept across jurisdictions. Build certification API that smaller carbon projects integrate to achieve verification faster and cheaper.\n\nEconomics: Development costs split 50/50. Each party uses the MRV stack for their own projects at cost. Third-party licensing generates profit—charge $50-150 per ton verified, target 5-10 megatons/year of third-party volume within 36 months. This creates industry-standard rails that become defensible as regulatory acceptance compounds.`;
        }
        
        if (anchorType === 'Luxury' || prospectType === 'Luxury') {
            return `**Heritage Collaboration Framework**\n\nLuxury brands protect exclusivity through production limits and controlled distribution. ${anchor} and ${prospect} collaborate by co-creating limited objects that express both brands' heritage without diluting either. Production capped at 500-2000 units globally. Distribution exclusively through ${anchor}'s channels maintains brand control.\n\nDesign authority: ${anchor} directs aesthetic and materials; ${prospect} contributes specialized manufacturing capability or material innovation. Revenue split reflects brand value contribution (typically 70/30 favoring the brand with stronger positioning).\n\nCritical constraint: No discounting, no outlet sales, no secondary market support. Items must maintain value post-purchase. If resale prices drop below retail, the collaboration harmed both brands. This requires absolute commitment to scarcity—better to leave demand unsatisfied than to overproduce.`;
        }
        
        if (anchorType === 'DeepTech' || prospectType === 'DeepTech') {
            return `**Layer Integration and Joint Optimization**\n\n${anchor} operates at layer N of the infrastructure stack; ${prospect} operates at layer N+1 or N-1. Partnership creates value by optimizing across layers rather than treating each as independent.\n\nTechnical mechanism: Expose low-level primitives from ${anchor}'s layer to ${prospect}'s layer. This enables ${prospect} to make optimization decisions that would be impossible if layers were decoupled via standard APIs. Example: If ${anchor} provides compute and ${prospect} provides storage, tight integration allows ${prospect} to colocate storage with compute to minimize latency.\n\nMonetization: Customers pay for the integrated stack. Revenue split based on value contribution—measure via proxy metrics like compute-hours consumed vs. storage capacity utilized. The defensibility emerges from optimization depth: competitors offering best-of-breed components can't match the performance of the vertically-optimized stack.`;
        }
        
        return `**Operational Handshake Points**\n\n${anchor} and ${prospect} must identify specific process integrations where capability from one company enhances the other's operations. Generic "partnerships" fail; specific technical or operational integrations create value.\n\nDiligence questions: Where does ${prospect}'s operational bottleneck align with ${anchor}'s capability surplus? What data or process flow from ${anchor} to ${prospect} eliminates redundant work? Can customers using both platforms achieve outcomes impossible with either alone?\n\nStructure as pilot: Identify single integration point, implement MVP, measure customer usage/value, then decide whether to deepen integration. Most partnerships should die after pilot—better to kill bad partnerships quickly than to maintain them out of inertia.`;
    }

    function buildArbitrageHunter(score) {
        const anchor = anchorData.name;
        const prospect = prospectData.name;
        const anchorType = anchorData.vertical.type;
        const prospectType = prospectData.vertical.type;
        
        if (anchorType === 'Space' && prospectType === 'Space') {
            return `**"Verified Orbital Manufacturing" Label**\n\nNo existing certification distinguishes materials manufactured in microgravity from terrestrial alternatives. ${anchor} and ${prospect} can co-create this standard, then license it to future orbital manufacturers.\n\nValue proposition: Pharmaceutical or materials companies pay premium for "Verified Orbital" certification that proves manufacturing occurred in microgravity with documented quality controls. This matters for products where microgravity processing creates superior material properties (certain protein crystals, fiber optics, alloys).\n\nGo-to-market: Establish certification criteria jointly. ${anchor} and ${prospect} certify their own products first to demonstrate value. License certification framework to competitors for $100-500K per company plus royalty on certified product revenue. As more manufacturers adopt the standard, it becomes industry requirement rather than optional marketing.`;
        }
        
        if (anchorType === 'Climate' || prospectType === 'Climate') {
            return `**Carbon-Neutral Industrial Process Licensing**\n\nMany industrial processes generate unavoidable CO₂ (cement, steel, chemicals). ${anchor} and ${prospect} co-develop carbon removal integration that allows these industries to claim carbon-neutrality.\n\nBusiness model: License turn-key carbon removal solutions to industrial customers. ${anchor} provides removal technology; ${prospect} provides verification. Customer pays fixed price per ton of industrial emissions offset. Target customers: companies facing carbon pricing or regulatory pressure who will pay premium for certified carbon-neutral operations.\n\nPricing: $150-300 per ton removed (vs. $50-100 for speculative carbon credits). Higher price justified by permanence guarantees and real-time verification. Market size: Industrial CO₂ emissions exceed 10 gigatons annually—capturing 1% of this market generates $1.5-3B in annual revenue.`;
        }
        
        if (anchorType === 'Luxury' || prospectType === 'Luxury') {
            return `**Heritage Preservation Services**\n\nUltra-high-net-worth individuals collect luxury objects but lack expertise to maintain them across generations. ${anchor} and ${prospect} co-create "Heritage Stewardship" services that preserve and authenticate luxury collections.\n\nOffering: Combine ${anchor}'s authentication expertise with ${prospect}'s conservation/storage capabilities. Services include: condition monitoring, restoration (when appropriate), provenance documentation, and estate planning for collection transfer.\n\nPricing: Annual retainer of $25-100K depending on collection value. Target market: collectors with $5M+ in luxury goods who view collections as multi-generational assets. This creates recurring revenue stream anchored in trust rather than transactions—clients renew annually to maintain provenance chain.`;
        }
        
        return `**Joint Infrastructure-as-a-Service**\n\n${anchor} and ${prospect} both developed capabilities that required significant capital investment. Other companies in their markets need similar capabilities but can't justify the capex. The arbitrage: offer infrastructure as service to these competitors.\n\nRevenue opportunity: Companies that built infrastructure for internal use often discover external demand exceeds internal consumption. Convert fixed costs into variable revenue by selling excess capacity. Price at 40-60% gross margin—customers still save vs. building themselves.\n\nRisk mitigation: Ensure external customers don't consume capacity needed for core business. Implement priority queuing where internal workloads preempt external customers. This protects core business while monetizing otherwise-idle assets.`;
    }

    function buildVettingQuestions(score) {
        const anchor = anchorData.name;
        const prospect = prospectData.name;
        const anchorType = anchorData.vertical.type;
        const prospectType = prospectData.vertical.type;
        
        let q1, q2, q3;
        
        if (anchorType === 'Space' || prospectType === 'Space') {
            q1 = `**1. Mass Budget and Delta-V Allocation:** Walk through the mission design: What's the total mass budget? How much delta-V do you allocate to orbital insertion vs. station-keeping vs. deorbit? Where does ${anchor}'s payload/capability fit in this budget, and what margin remains for contingencies? Space missions fail when mass budgets are optimistic—I need worst-case numbers, not nominal.`;
        } else if (anchorType === 'Climate' || prospectType === 'Climate') {
            q1 = `**1. Additionality and Verification Standards:** How do you prove that captured carbon wouldn't have been removed through natural processes? What third-party verifiers do you work with, and have any of them rejected your methodology? Carbon credits are worthless without credible additionality—show me the certification documentation and any disputes with verifiers.`;
        } else if (anchorType === 'Luxury' || prospectType === 'Luxury') {
            q1 = `**1. Brand Dilution Risk and Production Limits:** What's the maximum production volume that maintains scarcity? Have you ever exceeded this threshold, and if so, what happened to brand perception and resale values? Luxury brands die when they overproduce—I need your internal volume guardrails and the governance process that enforces them.`;
        } else {
            q1 = `**1. Unit Economics at Scale:** What's your current gross margin per unit, and how does it trend as you scale? Where are the primary cost drivers, and which costs are fixed vs. variable? Most partnerships fail because unit economics don't work at partnership volume—prove yours scale favorably.`;
        }
        
        if (anchorType === 'Regulated' || prospectType === 'Regulated') {
            q2 = `**2. Compliance Infrastructure and Data Residency:** What data can legally be shared across your platform boundary? Are there jurisdictional restrictions (GDPR, CCPA, sector-specific regulations) that limit integration? Who owns the compliance risk if ${anchor} exposes ${prospect}'s data to unauthorized parties—and is that risk insurable?`;
        } else if (anchorType === 'DeepTech' || prospectType === 'DeepTech') {
            q2 = `**2. CapEx vs. OpEx and Scaling Constraints:** How much capital did you invest to build current capacity, and what's the incremental capex to double it? Are there physical constraints (fab capacity, supply chain lead times) that limit scaling speed? Deep tech partnerships fail when one party can't scale to meet demand—I need your expansion roadmap with capital requirements itemized.`;
        } else {
            q2 = `**2. P&L Ownership and Incentive Alignment:** Who internally owns partnership revenue, and is it material to their compensation? If this partnership generates $5M in Year 1, whose bonus increases? Partnerships die when they're nobody's primary responsibility—prove someone senior is incentivized to make this succeed.`;
        }
        
        q3 = `**3. Competitive Defensive Moats:** If this partnership scales, what prevents ${prospect} from building ${anchor}'s capability in-house or acquiring a competitor? Conversely, what stops ${anchor} from bypassing ${prospect} and going direct? Partnerships require mutual dependency—explain why each party needs the other long-term, not just opportunistically.`;
        
        return `${q1}\n\n${q2}\n\n${q3}`;
    }

    function displayResults(brief) {
        document.getElementById('modalProspectName').textContent = prospectData.name;
        document.getElementById('modalProspectUrl').textContent = prospectData.url.replace('https://', '').replace('http://', '');
        document.getElementById('matchScore').textContent = brief.score + '%';
        document.getElementById('anchorVertical').textContent = anchorData.vertical.type;
        document.getElementById('prospectVertical').textContent = prospectData.vertical.type;
        
        document.getElementById('briefContent').innerHTML = marked.parse(brief.markdown);
        
        hideProgress();
        document.getElementById('resultsModal').classList.remove('hidden');
        document.body.style.overflow = 'hidden';
    }

    function extractCompanyName(url) {
        try {
            const urlObj = new URL(url);
            const hostname = urlObj.hostname.replace('www.', '');
            const domain = hostname.split('.')[0].toLowerCase().replace(/[-_]/g, '');
            
            const brands = {
                'varda': 'Varda',
                'apex': 'Apex',
                'nvidia': 'Nvidia',
                'hermes': 'Hermès',
                'belvo': 'Belvo',
                'carbonengineering': 'Carbon Engineering',
                'climeworks': 'Climeworks',
                'ald': 'ALD'
            };
            
            if (brands[domain]) return brands[domain];
            
            let name = hostname.split('.')[0];
            name = name.replace(/([a-z])([A-Z])/g, '$1 $2');
            name = name.split(/[-_\s]+/).map(w => 
                w.charAt(0).toUpperCase() + w.slice(1).toLowerCase()
            ).join(' ');
            
            return name;
        } catch (e) {
            return 'Company';
        }
    }

    async function searchTavily(query) {
        try {
            const response = await fetch('https://api.tavily.com/search', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    api_key: TAVILY_API_KEY,
                    query: query,
                    search_depth: 'advanced',
                    max_results: 5,
                    include_answer: true
                })
            });
            
            if (!response.ok) throw new Error('Search failed');
            return await response.json();
        } catch (error) {
            console.error('Search error:', error);
            return { answer: 'Company information.', results: [] };
        }
    }

    function showProgress(text, subtext) {
        document.getElementById('initialInput').classList.add('hidden');
        document.getElementById('clarificationSection').classList.add('hidden');
        document.getElementById('progressSection').classList.remove('hidden');
        document.getElementById('progressText').textContent = text;
        document.getElementById('progressSubtext').textContent = subtext;
    }

    function updateProgress(text, subtext) {
        document.getElementById('progressText').textContent = text;
        document.getElementById('progressSubtext').textContent = subtext;
    }

    function hideProgress() {
        document.getElementById('progressSection').classList.add('hidden');
    }

    function reset() {
        hideProgress();
        document.getElementById('clarificationSection').classList.add('hidden');
        document.getElementById('initialInput').classList.remove('hidden');
    }

    function closeModal() {
        document.getElementById('resultsModal').classList.add('hidden');
        document.body.style.overflow = 'auto';
        reset();
    }

    function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }

    document.addEventListener('DOMContentLoaded', function() {
        loadSavedAnchor();
        
        document.getElementById('analyzeBtn').addEventListener('click', function(e) {
            e.preventDefault();
            analyze();
        });
        
        document.getElementById('continueBtn').addEventListener('click', function(e) {
            e.preventDefault();
            continueWithGoal();
        });
        
        document.getElementById('cancelBtn').addEventListener('click', function(e) {
            e.preventDefault();
            reset();
        });
        
        document.getElementById('closeBtn').addEventListener('click', function(e) {
            e.preventDefault();
            closeModal();
        });
        
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') closeModal();
        });
    });
})();
    </script>
</body>
</html>
