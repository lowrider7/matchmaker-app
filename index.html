<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strategic Partner Scout</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.marked.min.js@12.0.0/marked.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * { font-family: 'Inter', sans-serif; }
        body { background: #0a0f1e; min-height: 100vh; }
        
        .card {
            background: rgba(15, 23, 42, 0.7);
            border: 1px solid rgba(71, 85, 105, 0.3);
        }
        
        .input-field {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(71, 85, 105, 0.5);
            transition: all 0.3s ease;
        }
        
        .input-field:focus {
            outline: none;
            border-color: rgba(99, 102, 241, 0.6);
            background: rgba(0, 0, 0, 0.6);
        }
        
        .clarification-box {
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.3);
            animation: slideDown 0.4s ease;
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }
        
        .modal-content {
            background: linear-gradient(180deg, #0f172a 0%, #1e293b 100%);
            border: 2px solid rgba(99, 102, 241, 0.3);
            max-width: 1100px;
            width: 94%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideIn 0.4s ease;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.8);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-30px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        .spinner {
            width: 40px; height: 40px;
            border: 3px solid rgba(99, 102, 241, 0.2);
            border-top-color: #6366f1;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .match-score {
            font-size: 4rem;
            font-weight: 700;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .section-divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(71, 85, 105, 0.5), transparent);
        }
        
        .reality-tier {
            background: rgba(139, 92, 246, 0.2);
            border: 2px solid rgba(139, 92, 246, 0.5);
            color: #c4b5fd;
            font-size: 0.875rem;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 700;
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }
        
        .insight-badge {
            background: rgba(34, 197, 94, 0.15);
            border: 1px solid rgba(34, 197, 94, 0.3);
            color: #86efac;
        }
        
        .hidden { display: none !important; }
        
        .progress-bar {
            width: 100%; height: 2px;
            background: rgba(71, 85, 105, 0.3);
            position: relative; overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #6366f1, #8b5cf6);
            animation: progress 2.5s ease-in-out;
        }
        
        @keyframes progress {
            0% { width: 0%; }
            100% { width: 100%; }
        }
        
        .markdown-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        
        .markdown-content th {
            background: rgba(99, 102, 241, 0.1);
            padding: 0.75rem;
            text-align: left;
            border: 1px solid rgba(71, 85, 105, 0.3);
            font-weight: 600;
            color: #c4b5fd;
        }
        
        .markdown-content td {
            padding: 0.75rem;
            border: 1px solid rgba(71, 85, 105, 0.3);
            color: #d1d5db;
        }
        
        .markdown-content tr:hover {
            background: rgba(99, 102, 241, 0.05);
        }
        
        .markdown-content strong {
            color: #c4b5fd;
            font-weight: 600;
        }
        
        .markdown-content p {
            margin: 0.75rem 0;
            line-height: 1.7;
        }

        .markdown-content h2 {
            color: #e5e7eb;
            font-size: 1.5rem;
            font-weight: 600;
            margin: 2rem 0 1rem 0;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(71, 85, 105, 0.3);
        }

        .markdown-content h3 {
            color: #d1d5db;
            font-size: 1.25rem;
            font-weight: 600;
            margin: 1.5rem 0 0.75rem 0;
        }
    </style>
</head>
<body class="text-gray-100">
    <div class="min-h-screen p-6">
        <div class="max-w-4xl mx-auto">
            <div class="mb-8 text-center">
                <h1 class="text-3xl font-light text-gray-300 mb-1">Strategic Partner Scout</h1>
                <p class="text-sm text-gray-500">Senior Partner Analysis</p>
            </div>

            <div class="card rounded-lg p-8">
                <div id="initialInput">
                    <div class="space-y-4 mb-6">
                        <div>
                            <label class="text-sm text-gray-400 mb-2 block">Anchor Company URL</label>
                            <input 
                                type="url" 
                                id="anchorUrl"
                                placeholder="https://your-company.com"
                                class="input-field w-full px-4 py-3 rounded text-sm"
                            />
                        </div>
                        
                        <div>
                            <label class="text-sm text-gray-400 mb-2 block">Prospect Company URL</label>
                            <input 
                                type="url" 
                                id="prospectUrl"
                                placeholder="https://prospect-company.com"
                                class="input-field w-full px-4 py-3 rounded text-sm"
                            />
                        </div>
                    </div>
                    
                    <button 
                        id="analyzeBtn"
                        type="button"
                        class="w-full bg-indigo-600 hover:bg-indigo-700 px-6 py-3.5 rounded font-medium transition-all"
                    >
                        Analyze Partnership
                    </button>
                </div>
                
                <div id="progressSection" class="hidden">
                    <div class="text-center py-12">
                        <div class="spinner mx-auto mb-4"></div>
                        <p class="text-sm text-gray-400 mb-2" id="progressText">Scanning...</p>
                        <p class="text-xs text-gray-500" id="progressSubtext"></p>
                        <div class="progress-bar mt-4">
                            <div class="progress-fill"></div>
                        </div>
                    </div>
                </div>
                
                <div id="clarificationSection" class="hidden">
                    <div class="clarification-box rounded-lg p-6">
                        <div class="flex items-start gap-3 mb-4">
                            <div class="insight-badge px-3 py-1 rounded-full text-xs font-semibold">Intelligence</div>
                        </div>
                        
                        <h3 class="text-lg font-semibold mb-2">Strategic Context Required</h3>
                        <p class="text-sm text-gray-400 mb-4">We've scanned <span id="foundCompany" class="text-gray-300"></span>. What is your primary strategic objective?</p>
                        
                        <div class="mb-4">
                            <input 
                                type="text" 
                                id="strategicGoal"
                                placeholder="e.g., Deploy 500MW by Q4, Unlock institutional flow, Preserve heritage positioning"
                                class="input-field w-full px-4 py-3 rounded text-sm"
                            />
                        </div>
                        
                        <div class="flex gap-3">
                            <button 
                                id="continueBtn"
                                type="button"
                                class="flex-1 bg-indigo-600 hover:bg-indigo-700 px-6 py-3 rounded font-medium transition-all"
                            >
                                Continue
                            </button>
                            <button 
                                id="cancelBtn"
                                type="button"
                                class="px-6 py-3 bg-slate-700 hover:bg-slate-600 rounded font-medium transition-all"
                            >
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="resultsModal" class="modal-overlay hidden">
        <div class="modal-content rounded-lg">
            <div class="p-8">
                <div class="flex items-start justify-between mb-6">
                    <div class="flex-1">
                        <h3 class="text-2xl font-semibold mb-2" id="modalProspectName">Company</h3>
                        <p class="text-sm text-gray-400 mb-4" id="modalProspectUrl">company.com</p>
                        <div class="flex gap-3 items-center flex-wrap">
                            <span class="reality-tier" id="realityTier"></span>
                        </div>
                    </div>
                    <button id="closeBtn" type="button" class="p-2 hover:bg-slate-700/50 rounded transition-all">
                        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                
                <div class="text-center mb-8">
                    <div class="match-score mb-2" id="matchScore">0%</div>
                    <p class="text-xs text-gray-500 uppercase tracking-wider">Strategic Fit</p>
                </div>
                
                <div class="section-divider mb-8"></div>
                
                <div class="markdown-content" id="briefContent"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked@12.0.0/marked.min.js"></script>
    <script>
(function() {
    'use strict';
    
    const TAVILY_API_KEY = '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';
    const STORAGE_KEY = 'sps_anchor_url';
    
    let anchorData = {};
    let prospectData = {};
    let strategicGoal = '';

    // REALITY TIER CLASSIFICATION - Hard-coded rules based on actual business fundamentals
    function classifyRealityTier(companyInfo, companyName) {
        const info = companyInfo.toLowerCase();
        const name = companyName.toLowerCase();
        
        // Sovereign AI/Compute - Power, cooling, chips
        if (info.includes('gpu') || info.includes('datacenter') || info.includes('compute') ||
            info.includes('nvidia') || info.includes('semiconductor') || info.includes('chip') ||
            (info.includes('power') && info.includes('megawatt')) || info.includes('liquid cooling') ||
            name.includes('nvidia') || name.includes('applied digital')) {
            return {
                tier: 'Sovereign AI/Compute',
                fundamentals: ['MW Power Capacity', 'Liquid Cooling Infrastructure', 'CapEx per GPU', 'PUE Efficiency']
            };
        }
        
        // Institutional RWA/Yield - Settlement, collateral, treasury
        if (info.includes('treasury') || info.includes('yield') || info.includes('institutional') ||
            info.includes('settlement') || info.includes('collateral') || info.includes('rwa') ||
            (info.includes('blackrock') || info.includes('airwallex')) ||
            (info.includes('asset') && info.includes('real world'))) {
            return {
                tier: 'Institutional RWA/Yield',
                fundamentals: ['Collateral Quality', 'APY Structure', 'Settlement Rails', 'Regulatory Framework']
            };
        }
        
        // Climate/Grid-Scale - Carbon, power, interconnection
        if ((info.includes('carbon') && (info.includes('capture') || info.includes('removal'))) ||
            info.includes('climate') || info.includes('grid') || info.includes('renewable') ||
            info.includes('interconnection') || info.includes('additionality') ||
            name.includes('carbon') || name.includes('climeworks')) {
            return {
                tier: 'Climate/Grid-Scale',
                fundamentals: ['Life Cycle Assessment', 'Additionality Verification', 'Grid Interconnection Queue', 'Permanence Guarantees']
            };
        }
        
        // High-Touch/Prestige - Luxury, heritage, scarcity
        if (info.includes('luxury') || info.includes('heritage') || info.includes('artisan') ||
            info.includes('prestige') || info.includes('haute') || info.includes('bespoke') ||
            name.includes('hermès') || name.includes('hermes') || name.includes('lvmh') ||
            (info.includes('average order value') && info.includes('high'))) {
            return {
                tier: 'High-Touch/Prestige',
                fundamentals: ['Average Order Value', 'Scarcity Management', 'Heritage Narrative', 'Resale Value']
            };
        }
        
        // Default to Technology if no specific tier matches
        return {
            tier: 'Technology/Platform',
            fundamentals: ['Unit Economics', 'Customer Acquisition Cost', 'Gross Margin', 'Market Share']
        };
    }

    function loadSavedAnchor() {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) document.getElementById('anchorUrl').value = saved;
    }

    function saveAnchorUrl(url) {
        localStorage.setItem(STORAGE_KEY, url);
    }

    async function analyze() {
        const anchorUrl = document.getElementById('anchorUrl').value.trim();
        const prospectUrl = document.getElementById('prospectUrl').value.trim();
        
        if (!anchorUrl || !prospectUrl) {
            alert('Please enter both URLs');
            return;
        }
        
        try {
            new URL(anchorUrl);
            new URL(prospectUrl);
        } catch (e) {
            alert('Please enter valid URLs');
            return;
        }
        
        // TOTAL MEMORY PURGE - reset all state
        anchorData = {};
        prospectData = {};
        strategicGoal = '';
        
        saveAnchorUrl(anchorUrl);
        showProgress('Scanning anchor company...', 'Classifying reality tier');
        
        try {
            await sleep(500);
            
            const anchorName = extractCompanyName(anchorUrl);
            const anchorQuery = anchorName + ' company business operations technology infrastructure';
            const anchorResults = await searchTavily(anchorQuery);
            
            anchorData = {
                name: anchorName,
                url: anchorUrl,
                info: anchorResults.answer || '',
                results: anchorResults.results || []
            };
            
            if (anchorResults.results && anchorResults.results.length > 0) {
                anchorData.info += ' ' + anchorResults.results.map(r => r.content).join(' ');
            }
            
            anchorData.tier = classifyRealityTier(anchorData.info, anchorData.name);
            
            await sleep(400);
            
            updateProgress('Analyzing depth...', 'Checking fundamentals');
            await sleep(300);
            
            const needsGoal = anchorData.info.length < 180;
            
            if (needsGoal) {
                showClarification(anchorData.name);
            } else {
                strategicGoal = extractGoal(anchorData);
                await analyzeProspect(prospectUrl);
            }
            
        } catch (error) {
            console.error('Error:', error);
            alert('Analysis failed. Please try again.');
            reset();
        }
    }

    function extractGoal(data) {
        const tier = data.tier.tier;
        if (tier === 'Sovereign AI/Compute') return 'deploy 500MW of AI compute capacity';
        if (tier === 'Institutional RWA/Yield') return 'unlock institutional treasury flow';
        if (tier === 'Climate/Grid-Scale') return 'scale to 100kt carbon removal annually';
        if (tier === 'High-Touch/Prestige') return 'preserve heritage while expanding client base';
        return 'accelerate revenue growth';
    }

    function showClarification(companyName) {
        hideProgress();
        document.getElementById('foundCompany').textContent = companyName;
        document.getElementById('initialInput').classList.add('hidden');
        document.getElementById('clarificationSection').classList.remove('hidden');
    }

    async function continueWithGoal() {
        const goal = document.getElementById('strategicGoal').value.trim();
        if (!goal) {
            alert('Please enter your strategic objective');
            return;
        }
        
        strategicGoal = goal;
        document.getElementById('clarificationSection').classList.add('hidden');
        showProgress('Continuing analysis...', '');
        
        const prospectUrl = document.getElementById('prospectUrl').value.trim();
        await analyzeProspect(prospectUrl);
    }

    async function analyzeProspect(prospectUrl) {
        try {
            updateProgress('Scanning prospect...', 'Classifying reality tier');
            await sleep(600);
            
            const prospectName = extractCompanyName(prospectUrl);
            const prospectQuery = prospectName + ' company business operations technology infrastructure';
            const prospectResults = await searchTavily(prospectQuery);
            
            prospectData = {
                name: prospectName,
                url: prospectUrl,
                info: prospectResults.answer || '',
                results: prospectResults.results || []
            };
            
            if (prospectResults.results && prospectResults.results.length > 0) {
                prospectData.info += ' ' + prospectResults.results.map(r => r.content).join(' ');
            }
            
            prospectData.tier = classifyRealityTier(prospectData.info, prospectData.name);
            
            await sleep(600);
            
            updateProgress('Building strategic thesis...', 'Physical fundamental analysis');
            await sleep(800);
            
            const brief = generateHardIsolationBrief();
            await sleep(400);
            
            displayResults(brief);
            
        } catch (error) {
            console.error('Error:', error);
            alert('Analysis failed: ' + error.message);
            reset();
        }
    }

    function generateHardIsolationBrief() {
        // IDENTITY FENCE: Use only anchor and prospect names from current URLs
        const anchorName = anchorData.name;
        const prospectName = prospectData.name;
        const anchorTier = anchorData.tier.tier;
        const prospectTier = prospectData.tier.tier;
        
        const score = calculateFit();
        const summary = buildExecutiveSummary(anchorName, prospectName, anchorTier, prospectTier, score);
        const matchmaker = buildMatchmaker(anchorName, prospectName, anchorTier, prospectTier, score);
        const arbitrage = buildArbitrage(anchorName, prospectName, anchorTier, prospectTier, score);
        const vetting = buildVetting(anchorName, prospectName, anchorTier, prospectTier, score);
        
        let markdown = `## Executive Summary\n\n${summary}\n\n`;
        markdown += `## The Matchmaker: Physical Fundamental\n\n${matchmaker}\n\n`;
        markdown += `## The Arbitrage Hunter: New Revenue Category\n\n${arbitrage}\n\n`;
        markdown += `## Executive Vetting\n\n${vetting}`;
        
        const displayTier = anchorTier === prospectTier ? anchorTier : `${anchorTier} × ${prospectTier}`;
        
        return { score, markdown, displayTier };
    }

    function calculateFit() {
        let score = 60;
        
        const anchorTier = anchorData.tier.tier;
        const prospectTier = prospectData.tier.tier;
        
        // Same tier = higher fit
        if (anchorTier === prospectTier) score += 18;
        
        // Complementary tiers
        const complementary = [
            ['Sovereign AI/Compute', 'Climate/Grid-Scale'],
            ['Institutional RWA/Yield', 'Climate/Grid-Scale'],
            ['High-Touch/Prestige', 'Technology/Platform']
        ];
        
        for (let pair of complementary) {
            if ((anchorTier === pair[0] && prospectTier === pair[1]) ||
                (anchorTier === pair[1] && prospectTier === pair[0])) {
                score += 14;
                break;
            }
        }
        
        // Fundamental keywords present in both
        const anchorFundamentals = anchorData.tier.fundamentals.map(f => f.toLowerCase());
        const prospectInfo = prospectData.info.toLowerCase();
        anchorFundamentals.forEach(f => {
            const keyword = f.split(' ')[0];
            if (prospectInfo.includes(keyword)) score += 3;
        });
        
        score = Math.min(score + (Math.random() * 8 - 4), 89);
        score = Math.max(score, 56);
        return Math.round(score);
    }

    function buildExecutiveSummary(anchor, prospect, anchorTier, prospectTier, score) {
        // HARD ISOLATION: Each tier combination gets unique logic
        
        if (anchorTier === 'Sovereign AI/Compute' && prospectTier === 'Sovereign AI/Compute') {
            return `${prospect} and ${anchor} both operate AI compute infrastructure, which means they're optimizing for identical constraints: megawatt power delivery, liquid cooling efficiency, and capital cost per GPU deployed. Partnership logic centers on whether combining infrastructure reduces per-GPU deployment cost or accelerates time-to-market for capacity expansions. The fundamental bottleneck in AI compute is grid interconnection—securing utility agreements for 100+ MW loads takes 18-36 months. If ${prospect} has excess interconnection capacity and ${anchor} has capital, the partnership unlocks stranded infrastructure value. Alternatively, if both parties face the same interconnection queue, partnership delivers zero value—they're competing for the same constrained resource rather than solving complementary problems.`;
        }
        
        if (anchorTier === 'Institutional RWA/Yield' && prospectTier === 'Institutional RWA/Yield') {
            return `${prospect} and ${anchor} both structure products for institutional treasury management, meaning they compete for the same end customer: CFOs allocating idle cash to yield-bearing instruments. Partnership makes sense only if ${prospect} controls distribution (banking relationships, custody integrations) while ${anchor} controls product (yield generation, risk management). Institutional buyers prioritize three factors in this order: regulatory compliance, counterparty credit quality, liquidity. Any partnership must preserve ${anchor}'s positioning on all three dimensions. If ${prospect}'s integration introduces additional compliance burden or credit risk, institutional buyers reject the product regardless of yield improvement.`;
        }
        
        if (anchorTier === 'Climate/Grid-Scale' && prospectTier === 'Climate/Grid-Scale') {
            return `${prospect} and ${anchor} both operate in carbon markets, where value derives from additionality proof and permanence guarantees. Partnership creates value if ${prospect} solves a technical bottleneck that ${anchor} faces in scaling carbon removal operations. The physical fundamental: carbon capture requires energy input (thermal or electrical), storage infrastructure (geological or material), and monitoring systems (atmospheric or underground sensors). If ${prospect} provides one component—say, renewable energy at below-market rates—while ${anchor} provides the capture technology, the partnership reduces the all-in cost per ton of CO₂ removed. Critical threshold: partnership only makes sense if combined cost structure enables profitable sales into voluntary carbon markets at current pricing ($50-150 per ton). If combined costs exceed $150/ton, the partnership requires regulatory carbon pricing to reach commercialization.`;
        }
        
        if (anchorTier === 'High-Touch/Prestige' && prospectTier === 'High-Touch/Prestige') {
            return `${prospect} and ${anchor} both operate prestige brands, which means partnership creates risk before it creates value. Luxury brands derive pricing power from scarcity and heritage—diluting either dimension destroys brand equity permanently. Partnership makes sense only if both brands serve different customer occasions: ${anchor} for moment X in the customer's life, ${prospect} for moment Y. If brands compete for the same emotional budget (e.g., both positioning as "everyday luxury"), partnership cannibalizes rather than expands. The only defensible structure: limited co-creation with production capped at sub-5,000 units globally, sold exclusively through ${anchor}'s distribution to preserve brand control. Revenue potential is capped by design—this isn't a growth partnership, it's a brand reinforcement partnership. Any volume target above 5,000 units triggers brand dilution risk.`;
        }
        
        if (anchorTier === 'Sovereign AI/Compute' && prospectTier === 'Climate/Grid-Scale') {
            return `${anchor} operates AI compute infrastructure requiring 50-500 MW of continuous power. ${prospect} operates grid-scale energy projects—likely renewable generation or grid storage. The physical fundamental: AI datacenters are power-hungry and geographically constrained by grid interconnection capacity. ${prospect} can unlock stranded infrastructure value if they control power delivery that ${anchor} needs but can't access through traditional utility contracts. Partnership structure: ${prospect} provides dedicated power allocation to ${anchor}'s facilities via power purchase agreement (PPA) or on-site generation. ${anchor} gains power security and potentially below-market rates; ${prospect} gains creditworthy offtaker that enables project financing. This works if ${prospect}'s power source is proximate to ${anchor}'s datacenter locations—long-distance transmission adds cost and complexity that erodes partnership economics.`;
        }
        
        if (anchorTier === 'Institutional RWA/Yield' && prospectTier === 'Climate/Grid-Scale') {
            return `${anchor} structures financial products for institutional treasuries. ${prospect} operates carbon removal or renewable projects requiring upfront capital. The arbitrage: institutional buyers seek yield-bearing assets with ESG attributes. ${prospect}'s projects generate carbon credits or renewable energy certificates that ${anchor} can package into institutional-grade financial instruments. The fundamental handshake: ${prospect} provides underlying cash flows (carbon credit sales, power sales); ${anchor} structures these into bonds or funds that meet institutional compliance requirements (credit rating, liquidity terms, reporting standards). Revenue model: ${anchor} takes 50-150 bps annually on assets under management; ${prospect} accesses lower-cost capital than project finance markets typically provide. This scales if ${prospect} can aggregate multiple projects into a portfolio that justifies ${anchor}'s structuring costs—minimum viable portfolio is $100-500M.`;
        }
        
        // Default case for other tier combinations
        return `${anchor} operates in ${anchorTier} while ${prospect} operates in ${prospectTier}. Strategic fit depends on identifying specific operational or technical integration points where capabilities from one tier solve bottlenecks in the other. Partnerships across reality tiers rarely succeed through generic "collaboration"—they require precise identification of how ${prospect}'s physical or financial infrastructure addresses a constraint ${anchor} faces. Without clear integration mechanics, this remains exploratory rather than strategic. Recommend deeper technical diligence to map ${prospect}'s specific capabilities against ${anchor}'s operational bottlenecks before committing BD resources.`;
    }

    function buildMatchmaker(anchor, prospect, anchorTier, prospectTier, score) {
        // Each tier gets tier-specific matchmaker logic
        
        if (anchorTier === 'Sovereign AI/Compute' && prospectTier === 'Sovereign AI/Compute') {
            return `**Shared Infrastructure Utilization**\n\n${prospect} operates datacenters with stranded capacity—GPUs deployed but not fully utilized due to customer acquisition lag. ${anchor} has compute demand but faces 12-18 month lead times for new datacenter builds. The physical handshake: ${anchor} leases excess capacity from ${prospect} on flexible terms while ${anchor}'s owned infrastructure comes online.\n\nPricing structure: ${anchor} pays slightly below market rate (10-15% discount) in exchange for committing to 12-24 month contracts that give ${prospect} revenue certainty. ${prospect} benefits from monetizing idle assets; ${anchor} benefits from immediate capacity access. Critical constraint: both parties must use compatible GPU architectures (e.g., both Nvidia H100) and networking fabric (InfiniBand vs. Ethernet). Incompatible hardware eliminates partnership value regardless of excess capacity.`;
        }
        
        if (anchorTier === 'Institutional RWA/Yield' && prospectTier === 'Institutional RWA/Yield') {
            return `**Custody and Settlement Integration**\n\n${prospect} maintains banking relationships and custody infrastructure that ${anchor} lacks. ${anchor} structures yield products that ${prospect}'s clients want but ${prospect} doesn't originate. The operational handshake: ${prospect} integrates ${anchor}'s products into their custody platform, allowing institutional clients to allocate to ${anchor}'s strategies without opening separate accounts.\n\nRevenue split: ${prospect} takes 20-40 bps for distribution and custody; ${anchor} retains management fees. Integration requirements: ${prospect} must support ${anchor}'s settlement rails (same-day vs. T+1) and reporting cadence (daily NAV, monthly statements). If ${prospect}'s custody system requires custom development for ${anchor}'s products, integration timeline extends 6-12 months and likely kills partnership momentum.`;
        }
        
        if (anchorTier === 'Climate/Grid-Scale' && prospectTier === 'Climate/Grid-Scale') {
            return `**MRV Infrastructure Sharing**\n\nCarbon projects require measurement, reporting, and verification (MRV) systems to prove additionality and quantify tons removed. ${prospect} has deployed MRV infrastructure (satellite monitoring, atmospheric sensors, third-party verification protocols). ${anchor} operates carbon removal projects but hasn't built equivalent MRV capabilities.\n\nThe handshake: ${prospect} licenses MRV infrastructure to ${anchor} at cost-plus pricing. ${anchor} reduces time-to-certification from 18 months to 6 months by leveraging ${prospect}'s established verification protocols. ${prospect} monetizes fixed infrastructure costs by spreading them across additional projects. Economics: ${prospect} charges $30-50 per ton verified; ${anchor} avoids $2-5M upfront MRV buildout. This scales if ${prospect}'s MRV systems are modular and don't require project-specific customization—bespoke monitoring defeats the cost-sharing rationale.`;
        }
        
        if (anchorTier === 'High-Touch/Prestige' && prospectTier === 'High-Touch/Prestige') {
            return `**Limited Heritage Co-Creation**\n\nPrestige partnerships succeed through scarcity, not scale. ${prospect} has manufacturing capability or material innovation that ${anchor} values. ${anchor} controls brand positioning and customer relationships. Structure: ${prospect} produces limited objects (500-2000 units) designed by ${anchor}'s creative team, sold exclusively through ${anchor}'s channels.\n\nRevenue split: 70/30 favoring ${anchor} due to brand value contribution. Production standards must match ${anchor}'s existing quality benchmarks—no cost optimization that compromises craftsmanship. Distribution exclusivity is non-negotiable: if ${prospect} attempts parallel sales through their channels, partnership terminates immediately. The partnership reinforces both brands only if the object is genuinely special—incremental SKUs dilute rather than enhance heritage narratives.`;
        }
        
        if (anchorTier === 'Sovereign AI/Compute' && prospectTier === 'Climate/Grid-Scale') {
            return `**Dedicated Power Allocation**\n\n${anchor} operates AI compute requiring continuous 100+ MW power delivery. ${prospect} operates renewable generation or has secured grid interconnection capacity that ${anchor} needs. The physical handshake: ${prospect} provides power to ${anchor}'s datacenters via power purchase agreement or on-site generation.\n\nEconomics: ${prospect} sells power at fixed rate ($40-60 per MWh) below retail but above wholesale, providing margin while giving ${anchor} cost certainty. ${anchor} gains power security critical for 24/7 GPU utilization. Key constraint: power source must be within 50 miles of ${anchor}'s facilities—long-distance transmission adds 15-30% to delivered cost and requires utility coordination that extends timeline 24+ months. If ${prospect}'s assets are remote, partnership requires ${anchor} to relocate datacenters to ${prospect}'s power source location.`;
        }
        
        return `**Operational Integration Points**\n\n${anchor} and ${prospect} must identify specific process handshakes where one party's capability solves the other's bottleneck. Generic partnerships fail—successful integrations require precise technical or operational alignment. The analysis must map ${prospect}'s specific assets (infrastructure, data, relationships) against ${anchor}'s specific constraints (regulatory, technical, financial). Structure as time-boxed pilot: select single integration point, implement MVP in 90 days, measure value created, then decide whether to expand. Most partnerships should terminate after pilot rather than continuing based on sunk cost or relationship momentum.`;
    }

    function buildArbitrage(anchor, prospect, anchorTier, prospectTier, score) {
        // New revenue category identification per tier
        
        if (anchorTier === 'Sovereign AI/Compute' && prospectTier === 'Sovereign AI/Compute') {
            return `**GPU-as-a-Service Marketplace**\n\nNeither ${anchor} nor ${prospect} currently operates a spot market for short-duration GPU compute. Both companies have utilization gaps—GPUs deployed but idle during off-peak hours. The opportunity: co-create marketplace where buyers can rent fractional GPU time (1-7 days) for model training or inference workloads.\n\nRevenue model: Platform takes 15-20% commission on transactions. Target market: ML researchers, small AI companies, enterprises with sporadic compute needs. Platform requires real-time availability API, standardized container images, and minute-level billing. Launch with beta cohort of 20-50 buyers to validate demand before building full marketplace infrastructure. If transaction volume exceeds 10,000 GPU-hours per month within six months, scale to broader market. Below this threshold, marketplace lacks liquidity and should be wound down.`;
        }
        
        if (anchorTier === 'Institutional RWA/Yield' && prospectTier === 'Climate/Grid-Scale') {
            return `**Utility-Backed Carbon Removal Bonds**\n\nInstitutional treasuries seek fixed-income instruments with ESG attributes and credit ratings above BBB. ${prospect} operates carbon removal projects that generate predictable cash flows from carbon credit sales. ${anchor} structures these cash flows into bonds that institutional buyers can hold in fixed-income portfolios.\n\nProduct structure: ${prospect} aggregates 5-10 projects into single entity. ${anchor} issues bonds backed by projected carbon credit revenue, with ${prospect}'s projects as underlying collateral. Coupon: 4-6% annual yield. Minimum issuance: $250M to justify structuring costs and achieve investment-grade rating. Buyers: corporate treasuries, pension funds, endowments seeking climate-aligned fixed income. This creates new revenue category—carbon projects accessing bond markets rather than relying solely on voluntary credit buyers. Launch viability requires ${prospect} demonstrating 5+ years of carbon credit sales history to support creditworthiness analysis.`;
        }
        
        if (anchorTier === 'High-Touch/Prestige' && prospectTier === 'High-Touch/Prestige') {
            return `**Heritage Curation Services**\n\nUltra-high-net-worth collectors acquire prestige objects but lack expertise to maintain multi-generational collections. ${prospect} and ${anchor} co-create "Heritage Stewardship"—concierge services for luxury collection management.\n\nServices: Authentication, conservation, provenance documentation, insurance coordination, estate planning. Pricing: $50-150K annual retainer per collection. Target: collectors with $10M+ in luxury goods viewing collections as dynastic assets. Revenue split: 50/50 between ${prospect} and ${anchor}. Market opportunity: estimated 5,000-10,000 qualified collectors globally. This creates recurring revenue anchored in trust rather than transactions—clients maintain services to preserve provenance chains that enhance future value. Service must be genuinely valuable, not pure brand licensing—superficial concierge offerings damage rather than enhance brand equity.`;
        }
        
        return `**Cross-Tier Product Innovation**\n\n${anchor} and ${prospect} operate in different tiers, which creates arbitrage opportunities if capabilities from one tier unlock new markets in the other. The opportunity requires identifying a customer need that neither company addresses independently but both can solve jointly.\n\nApproach: Customer research first—interview 20-30 potential buyers to validate demand before building product. Structure as pilot with 90-day launch window and predefined success metrics (X customers, Y revenue, Z retention). Allocate maximum $500K to pilot—if demand doesn't materialize, terminate rather than doubling down. Most cross-tier innovations fail because partners assume demand exists without validating willingness-to-pay. Prove demand with MVP before committing to scale.`;
    }

    function buildVetting(anchor, prospect, anchorTier, prospectTier, score) {
        // Tier-specific vetting questions
        
        let q1, q2, q3;
        
        if (anchorTier === 'Sovereign AI/Compute' || prospectTier === 'Sovereign AI/Compute') {
            q1 = `**1. Grid Interconnection and Power Certainty:** What megawatt capacity do you have under signed utility agreements vs. what's still in interconnection queue? For queue positions, what's your estimated commercial operation date and what risk factors could delay it? AI compute partnerships fail when projected power doesn't materialize—show me executed interconnection agreements, not letters of intent.`;
        } else if (anchorTier === 'Institutional RWA/Yield' || prospectTier === 'Institutional RWA/Yield') {
            q1 = `**1. Liquidity Buffers and Redemption Mechanics:** What's your current assets under management, and what percentage could redeem within 30 days without forcing asset sales? How do you handle liquidity mismatches between underlying assets (potentially illiquid) and investor redemption rights? Institutional partnerships break when one party can't meet redemption requests—prove your liquidity management handles stress scenarios.`;
        } else if (anchorTier === 'Climate/Grid-Scale' || prospectTier === 'Climate/Grid-Scale') {
            q1 = `**1. Additionality Documentation and Verification History:** Have any third-party verifiers rejected your additionality methodology, and if so, on what grounds? What percentage of your carbon credits have achieved final certification vs. remain in provisional status? Carbon partnerships fail when credits prove non-additional—show me verification reports from independent auditors, not self-certification.`;
        } else if (anchorTier === 'High-Touch/Prestige' || prospectTier === 'High-Touch/Prestige') {
            q1 = `**1. Heritage Control and Brand Governance:** What approval rights does ${anchor} retain over design, production, pricing, and distribution? How do you handle quality failures that threaten brand reputation—full recall or case-by-case remediation? Prestige partnerships fail when control is ambiguous. I need written governance specifying who has final authority at every decision point.`;
        } else {
            q1 = `**1. Unit Economics and Scaling Constraints:** At current scale, what's your gross margin per unit and how does it trend as volume doubles? Where are the primary cost drivers (COGS, labor, infrastructure) and which are fixed vs. variable? Partnerships fail when unit economics don't scale favorably—prove your margins improve or hold steady as volume increases.`;
        }
        
        if (anchorTier === 'Sovereign AI/Compute' || prospectTier === 'Sovereign AI/Compute') {
            q2 = `**2. CapEx Deployment and Expansion Timeline:** What's your current deployed GPU count and what's the capex per GPU including datacenter buildout? To double capacity, what's the capital requirement and timeline? AI infrastructure requires 18-36 month build cycles—show me your expansion roadmap with capital commitments itemized, not aspirational capacity targets.`;
        } else if (anchorTier === 'Institutional RWA/Yield' || prospectTier === 'Institutional RWA/Yield') {
            q2 = `**2. Regulatory Footprint and Compliance Infrastructure:** In which jurisdictions are you licensed to operate, and what's your regulatory status (registered, exempt, pending)? What compliance infrastructure do you maintain (audit trail, data retention, KYC/AML) and what annual cost does it represent? Cross-border partnerships fail when regulatory misalignment creates client access restrictions—map your regulatory licenses against ${anchor}'s target markets to identify gaps.`;
        } else if (anchorTier === 'Climate/Grid-Scale' || prospectTier === 'Climate/Grid-Scale') {
            q2 = `**2. Life Cycle Assessment and System Boundaries:** Walk me through your LCA methodology: what emissions sources are included in system boundaries and what's excluded? How do you account for upstream emissions (equipment manufacturing, transport) vs. operational emissions? LCA disputes kill carbon partnerships—show me third-party validation of your methodology, ideally ISO 14040/14044 compliant.`;
        } else {
            q2 = `**2. P&L Ownership and Incentive Alignment:** Who internally owns partnership revenue and is it material to their compensation? If this generates $10M in Year 1, whose bonus increases? Partnerships fail when they're nobody's core responsibility—identify the executive sponsor whose performance review includes partnership success metrics.`;
        }
        
        q3 = `**3. Competitive Positioning and Defensive Moats:** If this partnership scales to material revenue, what prevents ${prospect} from building ${anchor}'s core capability in-house or acquiring a competitor to bypass the partnership? What contractual or structural mechanisms lock in mutual dependency beyond the initial agreement term? Partnerships require credible commitment—show me why neither party can easily replace the other once the relationship has value.`;
        
        return `${q1}\n\n${q2}\n\n${q3}`;
    }

    function displayResults(brief) {
        document.getElementById('modalProspectName').textContent = prospectData.name;
        document.getElementById('modalProspectUrl').textContent = prospectData.url.replace('https://', '').replace('http://', '');
        document.getElementById('matchScore').textContent = brief.score + '%';
        document.getElementById('realityTier').textContent = brief.displayTier;
        
        document.getElementById('briefContent').innerHTML = marked.parse(brief.markdown);
        
        hideProgress();
        document.getElementById('resultsModal').classList.remove('hidden');
        document.body.style.overflow = 'hidden';
    }

    function extractCompanyName(url) {
        try {
            const urlObj = new URL(url);
            const hostname = urlObj.hostname.replace('www.', '');
            const domain = hostname.split('.')[0].toLowerCase().replace(/[-_]/g, '');
            
            const brands = {
                'nvidia': 'Nvidia',
                'applieddigital': 'Applied Digital',
                'blackrock': 'BlackRock',
                'airwallex': 'Airwallex',
                'carbondirect': 'Carbon Direct',
                'carboncapture': 'CarbonCapture',
                'climeworks': 'Climeworks',
                'hermes': 'Hermès',
                'ald': 'ALD'
            };
            
            if (brands[domain]) return brands[domain];
            
            let name = hostname.split('.')[0];
            name = name.replace(/([a-z])([A-Z])/g, '$1 $2');
            name = name.split(/[-_\s]+/).map(w => 
                w.charAt(0).toUpperCase() + w.slice(1).toLowerCase()
            ).join(' ');
            
            return name;
        } catch (e) {
            return 'Company';
        }
    }

    async function searchTavily(query) {
        try {
            const response = await fetch('https://api.tavily.com/search', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    api_key: TAVILY_API_KEY,
                    query: query,
                    search_depth: 'advanced',
                    max_results: 5,
                    include_answer: true
                })
            });
            
            if (!response.ok) throw new Error('Search failed');
            return await response.json();
        } catch (error) {
            console.error('Search error:', error);
            return { answer: 'Company information.', results: [] };
        }
    }

    function showProgress(text, subtext) {
        document.getElementById('initialInput').classList.add('hidden');
        document.getElementById('clarificationSection').classList.add('hidden');
        document.getElementById('progressSection').classList.remove('hidden');
        document.getElementById('progressText').textContent = text;
        document.getElementById('progressSubtext').textContent = subtext;
    }

    function updateProgress(text, subtext) {
        document.getElementById('progressText').textContent = text;
        document.getElementById('progressSubtext').textContent = subtext;
    }

    function hideProgress() {
        document.getElementById('progressSection').classList.add('hidden');
    }

    function reset() {
        hideProgress();
        document.getElementById('clarificationSection').classList.add('hidden');
        document.getElementById('initialInput').classList.remove('hidden');
    }

    function closeModal() {
        document.getElementById('resultsModal').classList.add('hidden');
        document.body.style.overflow = 'auto';
        reset();
    }

    function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }

    document.addEventListener('DOMContentLoaded', function() {
        loadSavedAnchor();
        
        document.getElementById('analyzeBtn').addEventListener('click', function(e) {
            e.preventDefault();
            analyze();
        });
        
        document.getElementById('continueBtn').addEventListener('click', function(e) {
            e.preventDefault();
            continueWithGoal();
        });
        
        document.getElementById('cancelBtn').addEventListener('click', function(e) {
            e.preventDefault();
            reset();
        });
        
        document.getElementById('closeBtn').addEventListener('click', function(e) {
            e.preventDefault();
            closeModal();
        });
        
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') closeModal();
        });
    });
})();
    </script>
</body>
</html>
