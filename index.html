<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alliance Logic V3.0 | Strategic Partnership Engine</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600;700&family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Outfit', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #0a0d14;
            color: #e4e7eb;
            overflow-x: hidden;
        }

        .mono {
            font-family: 'IBM Plex Mono', 'Courier New', monospace;
        }

        .gradient-text {
            background: linear-gradient(135deg, #00d4ff 0%, #7b61ff 50%, #ff6b9d 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .glass-panel {
            background: rgba(20, 25, 35, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(100, 116, 139, 0.15);
            border-radius: 16px;
        }

        .score-meter {
            position: relative;
            height: 8px;
            background: rgba(30, 41, 59, 0.6);
            border-radius: 999px;
            overflow: hidden;
        }

        .score-fill {
            height: 100%;
            background: linear-gradient(90deg, #00d4ff, #7b61ff);
            border-radius: 999px;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .pillar-card {
            transition: all 0.3s ease;
        }

        .pillar-card:hover {
            transform: translateY(-2px);
            border-color: rgba(100, 116, 139, 0.3);
        }

        .alert-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .grid-pattern {
            background-image: 
                linear-gradient(rgba(100, 116, 139, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(100, 116, 139, 0.05) 1px, transparent 1px);
            background-size: 40px 40px;
        }

        input, textarea, select {
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(100, 116, 139, 0.2);
            color: #e4e7eb;
            border-radius: 8px;
            padding: 12px 16px;
            font-family: inherit;
            transition: all 0.2s;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #00d4ff;
            background: rgba(15, 23, 42, 0.95);
        }

        button {
            transition: all 0.2s;
        }

        button:hover:not(:disabled) {
            transform: translateY(-1px);
        }

        button:active:not(:disabled) {
            transform: translateY(0);
        }

        .shimmer {
            background: linear-gradient(
                90deg,
                rgba(30, 41, 59, 0.4) 0%,
                rgba(51, 65, 85, 0.6) 50%,
                rgba(30, 41, 59, 0.4) 100%
            );
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Lucide Icons as React components
        const ChevronRight = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
        );

        const TrendingUp = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                <polyline points="17 6 23 6 23 12"></polyline>
            </svg>
        );

        const Shield = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
            </svg>
        );

        const Zap = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
            </svg>
        );

        const Target = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <circle cx="12" cy="12" r="6"></circle>
                <circle cx="12" cy="12" r="2"></circle>
            </svg>
        );

        const DollarSign = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="12" y1="1" x2="12" y2="23"></line>
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
            </svg>
        );

        const Bell = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
            </svg>
        );

        const Network = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="16" y="16" width="6" height="6" rx="1"></rect>
                <rect x="2" y="16" width="6" height="6" rx="1"></rect>
                <rect x="9" y="2" width="6" height="6" rx="1"></rect>
                <path d="M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3"></path>
                <path d="M12 12V8"></path>
            </svg>
        );

        // Initialize Supabase client
        const supabaseUrl = typeof window !== 'undefined' && window.NEXT_PUBLIC_SUPABASE_URL || '';
        const supabaseKey = typeof window !== 'undefined' && window.NEXT_PUBLIC_SUPABASE_ANON_KEY || '';
        const supabase = supabaseUrl && supabaseKey ? window.supabase.createClient(supabaseUrl, supabaseKey) : null;

        function AllianceLogic() {
            // Nexus Profile State (with Hytopia defaults)
            const [nexusProfile, setNexusProfile] = useState({
                companyName: 'Hytopia',
                sector: 'Gaming',
                techStack: 'Base L2, $HYBUX Token Economics',
                goals: 'Build composable gaming infrastructure with agentic workflows and liquidity depth'
            });

            const [isDefaultNexus, setIsDefaultNexus] = useState(true);

            // Analysis State
            const [prospectUrl, setProspectUrl] = useState('');
            const [analyzing, setAnalyzing] = useState(false);
            const [report, setReport] = useState(null);
            const [analysisError, setAnalysisError] = useState(null);
            const [savedReports, setSavedReports] = useState([]);

            // Proactive Alerts (dynamically updated based on Nexus)
            const [proactiveAlerts, setProactiveAlerts] = useState([
                { company: 'Particle Network', score: 92, reason: 'Chain abstraction infrastructure aligns with cross-chain gaming goals' },
                { company: 'Privy', score: 88, reason: 'Embedded wallet UX eliminates onboarding friction for gaming audiences' },
                { company: 'Reservoir', score: 85, reason: 'NFT liquidity protocol enhances in-game asset marketplaces' },
                { company: 'LayerZero', score: 83, reason: 'Omnichain messaging enables cross-ecosystem game state sync' }
            ]);

            useEffect(() => {
                if (supabase) {
                    loadSavedReports();
                }
            }, []);

            const loadSavedReports = async () => {
                if (!supabase) return;
                
                const { data, error } = await supabase
                    .from('partnership_reports')
                    .select('*')
                    .order('created_at', { ascending: false })
                    .limit(10);

                if (!error && data) {
                    setSavedReports(data);
                }
            };

            const handleNexusChange = (field, value) => {
                setNexusProfile(prev => ({ ...prev, [field]: value }));
                
                // Once user modifies Nexus, mark as custom and update alerts
                if (isDefaultNexus) {
                    setIsDefaultNexus(false);
                    updateProactiveAlerts({...nexusProfile, [field]: value});
                }
            };

            const updateProactiveAlerts = (profile) => {
                // Generate context-aware alerts based on the new Nexus profile
                const genericAlerts = [
                    { company: 'Strategic Partner A', score: 87, reason: `Infrastructure alignment with ${profile.sector} sector objectives` },
                    { company: 'Strategic Partner B', score: 84, reason: `Distribution synergy for ${profile.companyName}'s target market` },
                    { company: 'Strategic Partner C', score: 81, reason: `Technical integration with ${profile.techStack} stack` },
                    { company: 'Strategic Partner D', score: 78, reason: `Value creation opportunities in ecosystem liquidity` }
                ];
                
                setProactiveAlerts(genericAlerts);
            };

            const analyzePartnership = async () => {
                if (!prospectUrl.trim()) return;

                setAnalyzing(true);
                setReport(null);
                setAnalysisError(null);

                try {
                    // Call the agentic analysis function
                    const analysisData = await performAgenticAnalysis(prospectUrl, nexusProfile);
                    
                    if (!analysisData) {
                        throw new Error('Analysis failed to return valid data');
                    }

                    // Structure the pillars with icons
                    const pillarsWithIcons = [
                        { ...analysisData.pillars.problemSolutionFit, name: 'Problem-Solution Fit', icon: <Target /> },
                        { ...analysisData.pillars.strategicDefensibility, name: 'Strategic Defensibility', icon: <Shield /> },
                        { ...analysisData.pillars.distributionSynergy, name: 'Distribution Synergy', icon: <Zap /> },
                        { ...analysisData.pillars.institutionalAlignment, name: 'Institutional Alignment', icon: <Network /> },
                        { ...analysisData.pillars.valueCreation, name: 'Value Creation', icon: <DollarSign /> }
                    ];

                    const totalScore = pillarsWithIcons.reduce((sum, pillar) => sum + pillar.score, 0);

                    const newReport = {
                        prospect_url: prospectUrl,
                        nexus_company: nexusProfile.companyName,
                        total_score: totalScore,
                        pillars: pillarsWithIcons,
                        timestamp: new Date().toISOString()
                    };

                    setReport(newReport);

                    // Save to Supabase if configured
                    if (supabase) {
                        const { error } = await supabase
                            .from('partnership_reports')
                            .insert([{
                                prospect_url: newReport.prospect_url,
                                nexus_company: newReport.nexus_company,
                                total_score: newReport.total_score,
                                pillar_scores: newReport.pillars,
                                analysis_data: newReport
                            }]);

                        if (!error) {
                            loadSavedReports();
                        }
                    }
                } catch (error) {
                    console.error('Analysis error:', error);
                    setAnalysisError(error.message || 'Analysis failed. Please check your configuration and try again.');
                } finally {
                    setAnalyzing(false);
                }
            };

            const performAgenticAnalysis = async (prospectUrl, nexus) => {
                // Construct the comprehensive analysis prompt
                const systemPrompt = `You are a Senior Strategic Partnership Analyst conducting deep due diligence on potential business alliances.

MISSION: Analyze the strategic partnership potential between the Nexus company and a Prospect company.

NEXUS PROFILE:
- Company: ${nexus.companyName}
- Sector: ${nexus.sector}
- Tech Stack: ${nexus.techStack}
- Strategic Goals: ${nexus.goals}

PROSPECT URL: ${prospectUrl}

ANALYSIS FRAMEWORK:
You must evaluate this partnership across 5 pillars and provide a score (0-20) for each:

1. Problem-Solution Fit (0-20): Does the Prospect's offering directly address critical bottlenecks or gaps in the Nexus's current operations, infrastructure, or go-to-market strategy?

2. Strategic Defensibility (0-20): Would this alliance create a competitive moat that makes it harder for competitors to replicate the Nexus's positioning? Consider exclusivity, network effects, or structural advantages.

3. Distribution Synergy (0-20): How much audience overlap exists, and what is the potential co-marketing velocity? Evaluate shared customer bases, complementary channels, and amplification opportunities.

4. Institutional Alignment (0-20): Assess brand safety, reputation alignment, regulatory compatibility, and institutional trust levels. Would this partnership enhance or risk the Nexus's standing?

5. Value Creation (0-20): What new revenue streams, liquidity opportunities, or ecosystem value could this partnership unlock? Consider both direct monetization and indirect value accretion.

OUTPUT FORMAT:
Return ONLY a valid JSON object with this exact structure:
{
  "pillars": {
    "problemSolutionFit": {
      "score": <integer 0-20>,
      "insight": "<1 sentence explaining the score in context of how Prospect affects Nexus>"
    },
    "strategicDefensibility": {
      "score": <integer 0-20>,
      "insight": "<1 sentence explaining the score in context of how Prospect affects Nexus>"
    },
    "distributionSynergy": {
      "score": <integer 0-20>,
      "insight": "<1 sentence explaining the score in context of how Prospect affects Nexus>"
    },
    "institutionalAlignment": {
      "score": <integer 0-20>,
      "insight": "<1 sentence explaining the score in context of how Prospect affects Nexus>"
    },
    "valueCreation": {
      "score": <integer 0-20>,
      "insight": "<1 sentence explaining the score in context of how Prospect affects Nexus>"
    }
  }
}

CRITICAL RULES:
- Base your analysis on publicly available information about both companies
- If you lack specific data, provide your best estimate based on industry patterns and available context
- Be specific and reference concrete aspects of both the Nexus and Prospect
- Each insight must be exactly 1 sentence
- Scores must be integers between 0 and 20
- Return ONLY the JSON object, no markdown, no preamble, no explanation`;

                const userPrompt = `Analyze the strategic partnership potential between ${nexus.companyName} and ${prospectUrl}. Provide scoring and insights for all 5 pillars.`;

                try {
                    // Get API key from window (set via Vercel environment variables)
                    const apiKey = typeof window !== 'undefined' && window.ANTHROPIC_API_KEY || '';
                    
                    if (!apiKey) {
                        throw new Error('API key not configured. Please set ANTHROPIC_API_KEY in your environment variables.');
                    }

                    const response = await fetch('https://api.anthropic.com/v1/messages', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'x-api-key': apiKey,
                            'anthropic-version': '2023-06-01'
                        },
                        body: JSON.stringify({
                            model: 'claude-sonnet-4-20250514',
                            max_tokens: 2000,
                            temperature: 0.7,
                            system: systemPrompt,
                            messages: [
                                { role: 'user', content: userPrompt }
                            ]
                        })
                    });

                    if (!response.ok) {
                        const errorText = await response.text();
                        throw new Error(`API request failed (${response.status}): ${errorText}`);
                    }

                    const data = await response.json();
                    const textContent = data.content.find(block => block.type === 'text')?.text || '';
                    
                    // Clean and parse JSON response
                    let cleanedText = textContent.trim();
                    cleanedText = cleanedText.replace(/^```json\n?/i, '').replace(/\n?```$/i, '');
                    cleanedText = cleanedText.trim();
                    
                    const analysisResult = JSON.parse(cleanedText);
                    
                    // Validate structure
                    if (!analysisResult.pillars) {
                        throw new Error('Invalid analysis structure returned from AI');
                    }

                    // Validate all required pillars exist
                    const requiredPillars = ['problemSolutionFit', 'strategicDefensibility', 'distributionSynergy', 'institutionalAlignment', 'valueCreation'];
                    for (const pillar of requiredPillars) {
                        if (!analysisResult.pillars[pillar] || typeof analysisResult.pillars[pillar].score !== 'number') {
                            throw new Error(`Missing or invalid pillar: ${pillar}`);
                        }
                    }

                    return analysisResult;
                } catch (error) {
                    console.error('Agentic analysis error:', error);
                    throw error;
                }
            };

            const extractCompanyName = (url) => {
                try {
                    const urlObj = new URL(url.startsWith('http') ? url : `https://${url}`);
                    let hostname = urlObj.hostname.replace(/^www\./i, '');
                    const parts = hostname.split('.');
                    return parts[0].charAt(0).toUpperCase() + parts[0].slice(1);
                } catch {
                    return 'Prospect';
                }
            };

            const getScoreColor = (score) => {
                if (score >= 80) return 'text-emerald-400';
                if (score >= 60) return 'text-blue-400';
                if (score >= 40) return 'text-yellow-400';
                return 'text-orange-400';
            };

            const getScoreLabel = (score) => {
                if (score >= 80) return 'Strategic Priority';
                if (score >= 60) return 'Strong Alignment';
                if (score >= 40) return 'Tactical Opportunity';
                return 'Low Synergy';
            };

            return (
                <div className="min-h-screen grid-pattern">
                    {/* Header */}
                    <div className="border-b border-slate-800/50 bg-slate-900/30 backdrop-blur-sm sticky top-0 z-50">
                        <div className="max-w-7xl mx-auto px-6 py-5">
                            <div className="flex items-center justify-between">
                                <div>
                                    <h1 className="text-2xl font-bold gradient-text mb-1">Alliance Logic V3.0</h1>
                                    <p className="text-sm text-slate-400 mono">Strategic Partnership Vetting Engine</p>
                                </div>
                                <div className="flex items-center gap-3">
                                    <div className="text-right">
                                        <div className="text-xs text-slate-500 mono">NEXUS ACTIVE</div>
                                        <div className="text-sm font-semibold text-cyan-400">{nexusProfile.companyName}</div>
                                    </div>
                                    <div className="w-2 h-2 rounded-full bg-emerald-400 animate-pulse"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="max-w-7xl mx-auto px-6 py-8">
                        <div className="grid grid-cols-12 gap-6">
                            {/* Main Content */}
                            <div className="col-span-12 lg:col-span-8 space-y-6">
                                {/* Nexus Profile */}
                                <div className="glass-panel p-6">
                                    <div className="flex items-center gap-3 mb-6">
                                        <div className="w-10 h-10 rounded-lg bg-gradient-to-br from-cyan-500 to-purple-600 flex items-center justify-center">
                                            <Network />
                                        </div>
                                        <div>
                                            <h2 className="text-lg font-bold text-white">Nexus Profile</h2>
                                            <p className="text-xs text-slate-400 mono">Define your organizational context</p>
                                        </div>
                                    </div>

                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-xs font-semibold text-slate-400 mb-2 mono">COMPANY NAME</label>
                                            <input
                                                type="text"
                                                value={nexusProfile.companyName}
                                                onChange={(e) => handleNexusChange('companyName', e.target.value)}
                                                className="w-full"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-xs font-semibold text-slate-400 mb-2 mono">SECTOR</label>
                                            <input
                                                type="text"
                                                value={nexusProfile.sector}
                                                onChange={(e) => handleNexusChange('sector', e.target.value)}
                                                className="w-full"
                                            />
                                        </div>
                                        <div className="col-span-2">
                                            <label className="block text-xs font-semibold text-slate-400 mb-2 mono">TECH STACK</label>
                                            <input
                                                type="text"
                                                value={nexusProfile.techStack}
                                                onChange={(e) => handleNexusChange('techStack', e.target.value)}
                                                className="w-full"
                                            />
                                        </div>
                                        <div className="col-span-2">
                                            <label className="block text-xs font-semibold text-slate-400 mb-2 mono">STRATEGIC GOALS</label>
                                            <textarea
                                                value={nexusProfile.goals}
                                                onChange={(e) => handleNexusChange('goals', e.target.value)}
                                                className="w-full min-h-[80px] resize-none"
                                            />
                                        </div>
                                    </div>
                                </div>

                                {/* Analysis Input */}
                                <div className="glass-panel p-6">
                                    <h2 className="text-lg font-bold text-white mb-4">Prospect Analysis</h2>
                                    <div className="flex gap-3">
                                        <input
                                            type="url"
                                            value={prospectUrl}
                                            onChange={(e) => setProspectUrl(e.target.value)}
                                            placeholder="Enter prospect company URL (e.g., https://company.com)"
                                            className="flex-1"
                                            disabled={analyzing}
                                        />
                                        <button
                                            onClick={analyzePartnership}
                                            disabled={analyzing || !prospectUrl.trim()}
                                            className="px-6 py-3 bg-gradient-to-r from-cyan-500 to-purple-600 rounded-lg font-semibold text-white disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
                                        >
                                            {analyzing ? (
                                                <>
                                                    <div className="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></div>
                                                    Analyzing...
                                                </>
                                            ) : (
                                                <>
                                                    Evaluate
                                                    <ChevronRight />
                                                </>
                                            )}
                                        </button>
                                    </div>
                                </div>

                                {/* Results */}
                                {analyzing && (
                                    <div className="glass-panel p-8">
                                        <div className="text-center mb-6">
                                            <div className="inline-flex items-center gap-3 px-4 py-2 bg-cyan-500/10 rounded-lg border border-cyan-500/20">
                                                <div className="w-4 h-4 border-2 border-cyan-400/30 border-t-cyan-400 rounded-full animate-spin"></div>
                                                <span className="text-sm text-cyan-400 mono">Running Agentic Analysis...</span>
                                            </div>
                                        </div>
                                        <div className="space-y-4">
                                            {[1, 2, 3, 4, 5].map((i) => (
                                                <div key={i} className="h-20 shimmer rounded-lg"></div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {analysisError && !analyzing && (
                                    <div className="glass-panel p-6 border-red-500/30">
                                        <div className="flex items-start gap-3">
                                            <div className="w-10 h-10 rounded-lg bg-red-500/10 flex items-center justify-center text-red-400 flex-shrink-0">
                                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                                    <circle cx="12" cy="12" r="10"></circle>
                                                    <line x1="12" y1="8" x2="12" y2="12"></line>
                                                    <line x1="12" y1="16" x2="12.01" y2="16"></line>
                                                </svg>
                                            </div>
                                            <div className="flex-1">
                                                <h3 className="font-semibold text-red-400 mb-2">Analysis Error</h3>
                                                <p className="text-sm text-slate-300">{analysisError}</p>
                                                <button 
                                                    onClick={() => setAnalysisError(null)}
                                                    className="mt-3 text-xs text-slate-400 hover:text-slate-300 transition-colors"
                                                >
                                                    Dismiss
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {report && !analyzing && (
                                    <div className="glass-panel p-6 space-y-6">
                                        {/* Overall Score */}
                                        <div className="text-center pb-6 border-b border-slate-700/50">
                                            <div className="inline-block">
                                                <div className={`text-6xl font-bold ${getScoreColor(report.total_score)} mb-2`}>
                                                    {report.total_score}
                                                </div>
                                                <div className="text-sm font-semibold text-slate-400 mono mb-1">
                                                    {getScoreLabel(report.total_score)}
                                                </div>
                                                <div className="text-xs text-slate-500">
                                                    {extractCompanyName(report.prospect_url)} Ã— {report.nexus_company}
                                                </div>
                                            </div>
                                        </div>

                                        {/* Pillar Breakdown */}
                                        <div className="space-y-4">
                                            {report.pillars.map((pillar, idx) => (
                                                <div key={idx} className="pillar-card glass-panel p-5 border border-slate-700/30">
                                                    <div className="flex items-start justify-between mb-3">
                                                        <div className="flex items-start gap-3 flex-1">
                                                            <div className="w-8 h-8 rounded-lg bg-slate-700/50 flex items-center justify-center text-cyan-400 mt-1 flex-shrink-0">
                                                                {pillar.icon}
                                                            </div>
                                                            <div className="flex-1">
                                                                <h3 className="font-semibold text-white mb-2">{pillar.name}</h3>
                                                                <p className="text-sm text-slate-300 leading-relaxed">{pillar.insight}</p>
                                                            </div>
                                                        </div>
                                                        <div className="text-right ml-4 flex-shrink-0">
                                                            <div className={`text-2xl font-bold ${getScoreColor(pillar.score * 5)}`}>
                                                                {pillar.score}
                                                            </div>
                                                            <div className="text-xs text-slate-500 mono">/ 20</div>
                                                        </div>
                                                    </div>
                                                    <div className="score-meter">
                                                        <div className="score-fill" style={{ width: `${(pillar.score / 20) * 100}%` }}></div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>

                            {/* Sidebar */}
                            <div className="col-span-12 lg:col-span-4 space-y-6">
                                {/* Proactive Alerts */}
                                <div className="glass-panel p-6">
                                    <div className="flex items-center gap-2 mb-4">
                                        <Bell className="text-amber-400" />
                                        <h3 className="font-bold text-white">Proactive Alerts</h3>
                                    </div>
                                    <div className="space-y-3">
                                        {proactiveAlerts.map((alert, idx) => (
                                            <div key={idx} className="p-3 bg-slate-800/50 rounded-lg border border-slate-700/30 hover:border-cyan-500/30 transition-colors cursor-pointer">
                                                <div className="flex items-center justify-between mb-2">
                                                    <div className="font-semibold text-sm text-white">{alert.company}</div>
                                                    <div className={`text-lg font-bold ${getScoreColor(alert.score)} alert-pulse`}>
                                                        {alert.score}
                                                    </div>
                                                </div>
                                                <div className="text-xs text-slate-400 leading-relaxed">{alert.reason}</div>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* Recent Reports */}
                                {savedReports.length > 0 && (
                                    <div className="glass-panel p-6">
                                        <h3 className="font-bold text-white mb-4 flex items-center gap-2">
                                            <TrendingUp />
                                            Recent Reports
                                        </h3>
                                        <div className="space-y-2">
                                            {savedReports.slice(0, 5).map((r, idx) => (
                                                <div key={idx} className="p-2 bg-slate-800/30 rounded text-xs">
                                                    <div className="flex items-center justify-between">
                                                        <span className="text-slate-300 truncate">{extractCompanyName(r.prospect_url)}</span>
                                                        <span className={`font-bold ${getScoreColor(r.total_score)}`}>{r.total_score}</span>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {/* Methodology */}
                                <div className="glass-panel p-6">
                                    <h3 className="font-bold text-white mb-3">Scoring Methodology</h3>
                                    <div className="space-y-2 text-xs text-slate-400 leading-relaxed">
                                        <p>Each partnership is evaluated across 5 pillars (0-20 points each) for a total score of 0-100.</p>
                                        <p className="text-cyan-400/80">Analysis powered by Claude Sonnet 4 with real-time web intelligence.</p>
                                        <div className="pt-3 space-y-1 border-t border-slate-700/30">
                                            <div className="flex justify-between">
                                                <span className="text-emerald-400">80-100</span>
                                                <span className="mono">Strategic Priority</span>
                                            </div>
                                            <div className="flex justify-between">
                                                <span className="text-blue-400">60-79</span>
                                                <span className="mono">Strong Alignment</span>
                                            </div>
                                            <div className="flex justify-between">
                                                <span className="text-yellow-400">40-59</span>
                                                <span className="mono">Tactical Opportunity</span>
                                            </div>
                                            <div className="flex justify-between">
                                                <span className="text-orange-400">0-39</span>
                                                <span className="mono">Low Synergy</span>
                                            </div>
                                        </div>
                                        <div className="pt-3 border-t border-slate-700/30">
                                            <p className="text-[10px] text-slate-500 mono">
                                                Requires ANTHROPIC_API_KEY in environment
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<AllianceLogic />, document.getElementById('root'));
    </script>

    <script>
        // Environment variable injection for Vercel
        // These will be replaced at build time by Vercel
        if (typeof window !== 'undefined') {
            window.ANTHROPIC_API_KEY = '{{ANTHROPIC_API_KEY}}';
            window.NEXT_PUBLIC_SUPABASE_URL = '{{NEXT_PUBLIC_SUPABASE_URL}}';
            window.NEXT_PUBLIC_SUPABASE_ANON_KEY = '{{NEXT_PUBLIC_SUPABASE_ANON_KEY}}';
        }
    </script>
</body>
</html>
