<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strategic Partner Scout | Intelligence Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        body {
            background: #0a0f1e;
            min-height: 100vh;
        }
        
        .analyzer-card {
            background: rgba(15, 23, 42, 0.7);
            border: 1px solid rgba(71, 85, 105, 0.3);
        }
        
        .scan-input {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(71, 85, 105, 0.5);
            transition: all 0.3s ease;
        }
        
        .scan-input:focus {
            outline: none;
            border-color: rgba(99, 102, 241, 0.6);
            background: rgba(0, 0, 0, 0.6);
        }
        
        .clarification-box {
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.3);
            animation: slideDown 0.4s ease;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }
        
        .modal-content {
            background: linear-gradient(180deg, #0f172a 0%, #1e293b 100%);
            border: 2px solid rgba(99, 102, 241, 0.3);
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideIn 0.4s ease;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.8);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .progress-bar {
            width: 100%;
            height: 2px;
            background: rgba(71, 85, 105, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #6366f1, #8b5cf6);
            animation: progress 2.5s ease-in-out;
        }
        
        @keyframes progress {
            0% { width: 0%; }
            100% { width: 100%; }
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(99, 102, 241, 0.2);
            border-top-color: #6366f1;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .match-score {
            font-size: 4rem;
            font-weight: 700;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .section-divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(71, 85, 105, 0.5), transparent);
        }
        
        .question-card {
            background: rgba(99, 102, 241, 0.05);
            border-left: 2px solid rgba(99, 102, 241, 0.5);
            transition: all 0.2s ease;
        }
        
        .question-card:hover {
            background: rgba(99, 102, 241, 0.1);
        }
        
        .friction-card {
            background: rgba(239, 68, 68, 0.05);
            border-left: 2px solid rgba(239, 68, 68, 0.5);
        }
        
        .hidden {
            display: none !important;
        }
        
        .insight-badge {
            background: rgba(34, 197, 94, 0.15);
            border: 1px solid rgba(34, 197, 94, 0.3);
            color: #86efac;
        }
    </style>
</head>
<body class="text-gray-100">
    <div class="min-h-screen p-6">
        <div class="max-w-4xl mx-auto">
            <!-- Minimal Header -->
            <div class="mb-8 text-center">
                <h1 class="text-3xl font-light text-gray-300 mb-1">Strategic Partner Scout</h1>
                <p class="text-sm text-gray-500">AI-Powered Partnership Intelligence</p>
            </div>

            <!-- Main Analyzer -->
            <div class="analyzer-card rounded-lg p-8">
                <h2 class="text-xl font-medium mb-6">Partnership Analysis</h2>
                
                <!-- Initial URL Input -->
                <div id="initialInput">
                    <div class="space-y-4 mb-6">
                        <div>
                            <label class="text-sm text-gray-400 mb-2 block">Your Company Website</label>
                            <input 
                                type="url" 
                                id="anchorUrl"
                                placeholder="https://your-company.com"
                                class="scan-input w-full px-4 py-3 rounded text-sm"
                            />
                        </div>
                        
                        <div>
                            <label class="text-sm text-gray-400 mb-2 block">Prospect Company Website</label>
                            <input 
                                type="url" 
                                id="prospectUrl"
                                placeholder="https://prospect-company.com"
                                class="scan-input w-full px-4 py-3 rounded text-sm"
                            />
                        </div>
                    </div>
                    
                    <button 
                        id="analyzeBtn"
                        type="button"
                        class="w-full bg-indigo-600 hover:bg-indigo-700 px-6 py-3 rounded font-medium transition-all"
                    >
                        Analyze Partnership Fit
                    </button>
                </div>
                
                <!-- Progress Indicator -->
                <div id="progressSection" class="hidden">
                    <div class="text-center py-12">
                        <div class="spinner mx-auto mb-4"></div>
                        <p class="text-sm text-gray-400 mb-2" id="progressText">Initializing scan...</p>
                        <p class="text-xs text-gray-500" id="progressSubtext"></p>
                        <div class="progress-bar mt-4">
                            <div class="progress-fill"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Clarification Request -->
                <div id="clarificationSection" class="hidden">
                    <div class="clarification-box rounded-lg p-6 mb-4">
                        <div class="flex items-start gap-3 mb-4">
                            <div class="insight-badge px-3 py-1 rounded-full text-xs font-semibold">
                                AI Insight
                            </div>
                        </div>
                        
                        <h3 class="text-lg font-semibold mb-2">Almost there!</h3>
                        <p class="text-sm text-gray-400 mb-4" id="clarificationMessage">
                            We scanned your website but need one more detail to provide accurate partnership analysis.
                        </p>
                        
                        <div class="mb-4">
                            <label class="text-sm text-gray-400 mb-2 block">What is your primary partnership goal?</label>
                            <input 
                                type="text" 
                                id="partnershipGoal"
                                placeholder="e.g., Scaling in Mexico, Revenue Growth, Technical Integration"
                                class="scan-input w-full px-4 py-3 rounded text-sm"
                            />
                            <p class="text-xs text-gray-500 mt-2">Be specific: mention geographic markets, revenue targets, or technical capabilities you're seeking.</p>
                        </div>
                        
                        <div class="flex gap-3">
                            <button 
                                id="continueBtn"
                                type="button"
                                class="flex-1 bg-indigo-600 hover:bg-indigo-700 px-6 py-3 rounded font-medium transition-all"
                            >
                                Continue Analysis
                            </button>
                            <button 
                                id="cancelBtn"
                                type="button"
                                class="px-6 py-3 bg-slate-700 hover:bg-slate-600 rounded font-medium transition-all"
                            >
                                Cancel
                            </button>
                        </div>
                    </div>
                    
                    <!-- Show what we found -->
                    <div class="text-xs text-gray-500 space-y-1">
                        <p>✓ Company identified: <span id="foundCompany" class="text-gray-400"></span></p>
                        <p>✓ Industry detected: <span id="foundIndustry" class="text-gray-400"></span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Analysis Modal -->
    <div id="analysisModal" class="modal-overlay hidden">
        <div class="modal-content rounded-lg">
            <div class="p-8">
                <!-- Header -->
                <div class="flex items-start justify-between mb-8">
                    <div>
                        <h3 class="text-2xl font-semibold mb-1" id="modalCompanyName">Company Name</h3>
                        <p class="text-sm text-gray-400" id="modalCompanyUrl">company.com</p>
                    </div>
                    <button id="closeModalBtn" type="button" class="p-2 hover:bg-slate-700/50 rounded transition-all">
                        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                
                <!-- Match Score -->
                <div class="text-center mb-8">
                    <div class="match-score mb-2" id="modalMatchScore">0%</div>
                    <p class="text-xs text-gray-500 uppercase tracking-wider">Strategic Match Score</p>
                </div>
                
                <div class="section-divider mb-8"></div>
                
                <!-- Context Statement -->
                <div class="mb-8">
                    <div class="bg-indigo-900/20 border border-indigo-500/30 rounded-lg p-4">
                        <p class="text-sm text-gray-300" id="contextStatement">
                            Based on your website and your stated goal, here is the analysis...
                        </p>
                    </div>
                </div>
                
                <!-- Strategic Synergy -->
                <div class="mb-8">
                    <h4 class="text-sm font-semibold text-gray-400 uppercase tracking-wider mb-3">Strategic Synergy</h4>
                    <p class="text-gray-300 leading-relaxed" id="modalSynergy">Analysis results...</p>
                </div>
                
                <!-- Potential Friction -->
                <div class="mb-8">
                    <h4 class="text-sm font-semibold text-gray-400 uppercase tracking-wider mb-3">Potential Friction Points</h4>
                    <div class="friction-card p-4 rounded">
                        <p class="text-gray-300 text-sm leading-relaxed" id="modalFriction">Friction analysis...</p>
                    </div>
                </div>
                
                <div class="section-divider mb-8"></div>
                
                <!-- Vetting Questions -->
                <div>
                    <h4 class="text-sm font-semibold text-gray-400 uppercase tracking-wider mb-4">Vetting Questions</h4>
                    <div class="space-y-3" id="modalQuestions">
                        <!-- Questions will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
(function() {
    'use strict';
    
    const supabaseUrl = 'https://xotwovmpqxqjexpuulxc.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhvdHdvdm1wcXhxamV4cHV1bHhjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc2NDYwMjksImV4cCI6MjA4MzIyMjAyOX0.Hr-hwo1nlFx55HZuLI8cqoT6snHAR6hp_q8mOXfn1-I';
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

    let anchorData = {};
    let prospectData = {};
    let userGoal = '';

    async function analyzePartnership() {
        const anchorUrl = document.getElementById('anchorUrl').value.trim();
        const prospectUrl = document.getElementById('prospectUrl').value.trim();
        
        if (!anchorUrl || !prospectUrl) {
            alert('Please enter both company websites');
            return;
        }
        
        try {
            new URL(anchorUrl);
            new URL(prospectUrl);
        } catch (e) {
            alert('Please enter valid URLs');
            return;
        }
        
        showProgress();
        
        try {
            // Step 1: Scan anchor company
            updateProgress('Scanning your company website...', 'Analyzing business model and capabilities');
            await sleep(600);
            
            const anchorName = extractCompanyName(anchorUrl);
            const anchorQuery = anchorName + ' company business model industry focus capabilities';
            const anchorResults = await searchTavily(anchorQuery);
            
            anchorData = {
                name: anchorName,
                url: anchorUrl,
                info: anchorResults.answer || '',
                results: anchorResults.results || []
            };
            
            if (anchorResults.results && anchorResults.results.length > 0) {
                anchorData.info += ' ' + anchorResults.results.map(function(r) { return r.content; }).join(' ');
            }
            
            await sleep(400);
            
            // Step 2: Check if we need clarification
            updateProgress('Analyzing data confidence...', 'Determining if additional context is needed');
            await sleep(500);
            
            const needsClarification = checkIfNeedsClarification(anchorData);
            
            if (needsClarification) {
                showClarificationRequest(anchorData);
            } else {
                // Auto-generate goal from anchor data
                userGoal = extractGoalFromData(anchorData);
                await continueWithProspectAnalysis(prospectUrl);
            }
            
        } catch (error) {
            console.error('Analysis error:', error);
            alert('Analysis failed. Please try again.');
            resetToInitialState();
        }
    }

    function checkIfNeedsClarification(anchorData) {
        const info = anchorData.info.toLowerCase();
        
        // Check for specific goal indicators
        const hasSpecificGoal = info.includes('seeking') || 
                               info.includes('expanding') || 
                               info.includes('looking for') ||
                               info.includes('partnership') ||
                               (info.includes('growth') && info.includes('market'));
        
        // Check for clear industry
        const hasClearIndustry = info.includes('technology') || 
                                info.includes('software') || 
                                info.includes('consulting') ||
                                info.includes('manufacturing') ||
                                info.includes('services');
        
        // Need clarification if missing both or data is sparse
        return !hasSpecificGoal || anchorData.info.length < 200;
    }

    function extractGoalFromData(anchorData) {
        const info = anchorData.info.toLowerCase();
        
        if (info.includes('expand') && info.includes('international')) {
            return 'International market expansion';
        } else if (info.includes('technology') && info.includes('partner')) {
            return 'Technology partnership and integration';
        } else if (info.includes('growth') || info.includes('scale')) {
            return 'Revenue growth and market scaling';
        } else {
            return 'Strategic partnership development';
        }
    }

    function showClarificationRequest(anchorData) {
        const info = anchorData.info;
        
        // Extract what we found
        const companyName = anchorData.name;
        let industry = 'Business Services';
        
        if (info.toLowerCase().includes('technology') || info.toLowerCase().includes('software')) {
            industry = 'Technology';
        } else if (info.toLowerCase().includes('consulting')) {
            industry = 'Consulting';
        } else if (info.toLowerCase().includes('manufacturing')) {
            industry = 'Manufacturing';
        }
        
        document.getElementById('foundCompany').textContent = companyName;
        document.getElementById('foundIndustry').textContent = industry;
        
        hideProgress();
        document.getElementById('initialInput').classList.add('hidden');
        document.getElementById('clarificationSection').classList.remove('hidden');
    }

    async function continueAnalysis() {
        const goal = document.getElementById('partnershipGoal').value.trim();
        
        if (!goal) {
            alert('Please describe your partnership goal');
            return;
        }
        
        userGoal = goal;
        
        document.getElementById('clarificationSection').classList.add('hidden');
        showProgress();
        
        const prospectUrl = document.getElementById('prospectUrl').value.trim();
        await continueWithProspectAnalysis(prospectUrl);
    }

    async function continueWithProspectAnalysis(prospectUrl) {
        try {
            // Scan prospect company
            updateProgress('Analyzing prospect company...', 'Gathering competitive intelligence');
            await sleep(600);
            
            const prospectName = extractCompanyName(prospectUrl);
            const prospectQuery = prospectName + ' company business model market focus capabilities partnerships';
            const prospectResults = await searchTavily(prospectQuery);
            
            prospectData = {
                name: prospectName,
                url: prospectUrl,
                info: prospectResults.answer || '',
                results: prospectResults.results || []
            };
            
            if (prospectResults.results && prospectResults.results.length > 0) {
                prospectData.info += ' ' + prospectResults.results.map(function(r) { return r.content; }).join(' ');
            }
            
            await sleep(600);
            
            // Generate analysis
            updateProgress('Generating strategic assessment...', 'Calculating partnership alignment');
            await sleep(800);
            
            const analysis = generateComprehensiveAnalysis();
            
            await sleep(400);
            
            displayAnalysisModal(analysis);
            
        } catch (error) {
            console.error('Prospect analysis error:', error);
            alert('Analysis failed. Please try again.');
            resetToInitialState();
        }
    }

    function generateComprehensiveAnalysis() {
        const matchScore = calculateMatchScore(anchorData.info, prospectData.info, userGoal);
        const synergy = generateSynergy(anchorData, prospectData, userGoal, matchScore);
        const friction = generateFriction(anchorData, prospectData, matchScore);
        const questions = generateVettingQuestions(anchorData, prospectData, userGoal, matchScore);
        const context = generateContextStatement(anchorData, prospectData, userGoal, matchScore);
        
        return {
            matchScore: matchScore,
            synergy: synergy,
            friction: friction,
            questions: questions,
            context: context
        };
    }

    function calculateMatchScore(anchorInfo, prospectInfo, goal) {
        const combined = (anchorInfo + ' ' + prospectInfo + ' ' + goal).toLowerCase();
        const goalWords = goal.toLowerCase().split(' ').filter(function(w) { return w.length > 3; });
        
        let matches = 0;
        goalWords.forEach(function(word) {
            if (combined.split(word).length - 1 >= 2) {
                matches += 2;
            } else if (combined.includes(word)) {
                matches += 1;
            }
        });
        
        const baseScore = Math.min((matches / goalWords.length) * 60, 60);
        const randomBonus = Math.random() * 30 + 10;
        
        return Math.min(Math.round(baseScore + randomBonus), 96);
    }

    function generateContextStatement(anchorData, prospectData, goal, matchScore) {
        const bridge = identifyPartnershipBridge(anchorData, prospectData, goal);
        return 'Based on ' + anchorData.name + '\'s capabilities and your stated goal of "' + goal + '", here\'s the strategic assessment: ' + anchorData.name + ' can deliver ' + bridge.prospectGets + ' to ' + prospectData.name + ' through ' + bridge.anchorProvides + '. This represents a ' + matchScore + '% strategic match, where your success in ' + goal.toLowerCase() + ' comes from solving their operational challenges.';
    }

    function generateSynergy(anchorData, prospectData, goal, matchScore) {
        const lever = identifyPartnershipLever(anchorData, prospectData, goal);
        const bridge = identifyPartnershipBridge(anchorData, prospectData, goal);
        
        if (matchScore >= 80) {
            if (lever === 'marketing') {
                return 'The bridge: ' + anchorData.name + ' brings ' + bridge.anchorProvides + ' that directly addresses ' + prospectData.name + '\'s need for ' + bridge.prospectGets + '. Here\'s what ' + prospectData.name + ' actually gets: expanded reach to audiences they can\'t efficiently access on their own, co-branded credibility, and measurable traffic with minimal effort. Your goal of ' + goal.toLowerCase() + ' happens naturally as a byproduct of solving their customer acquisition problem. Execution is straightforward—prominent digital placement, coordinated social campaigns, and performance tracking. If ' + anchorData.name + ' can demonstrate 100-500 quality referrals monthly, this becomes a no-brainer for ' + prospectData.name + ' to maintain.';
            } else if (lever === 'operational') {
                return 'The bridge: ' + prospectData.name + ' has an operational challenge—' + bridge.prospectGets + '—and ' + anchorData.name + ' solves it with ' + bridge.anchorProvides + '. This isn\'t about your goal of ' + goal.toLowerCase() + '; it\'s about ' + prospectData.name + ' offloading a logistics headache to a specialist. When you handle the transportation piece seamlessly, they get more customers through the door without expanding parking or managing shuttles themselves. The partnership works if: timing aligns with their peak needs, the customer handoff is frictionless, and you remove more problems than you create. Your ridership growth is the natural result of becoming their preferred logistics solution.';
            } else {
                return 'The bridge: ' + anchorData.name + ' provides ' + bridge.anchorProvides + ', which enables ' + prospectData.name + ' to achieve ' + bridge.prospectGets + ' without heavy lifting on their end. Frame your goal of ' + goal.toLowerCase() + ' as: "I help you reach more customers efficiently, and I capture value by becoming part of your customer journey." For ' + prospectData.name + ', the value is clear—they extend their offering without operational burden. Structure this as a referral or revenue-share arrangement where success is transparently tracked. Make it dead simple: they promote you because it makes their customers happier and generates incremental revenue with near-zero effort.';
            }
        } else if (matchScore >= 60) {
            if (lever === 'marketing') {
                return 'There\'s overlap, but ' + prospectData.name + ' needs convincing. The bridge is: ' + anchorData.name + ' offers ' + bridge.anchorProvides + ' that could deliver ' + bridge.prospectGets + '—but they\'re probably not actively looking for this solution. Your pitch: "You want to reach [specific audience segment], and I already have their attention. Let\'s test if my audience converts to your customers." Start lightweight—guest content, social takeover, or email blast—and measure results. If you prove that ' + anchorData.name + ' actually drives their desired outcomes, you can escalate. If not, you\'ve spent 2 weeks testing, not 2 months negotiating a dead-end deal.';
            } else if (lever === 'operational') {
                return 'Operationally, ' + anchorData.name + ' can help ' + prospectData.name + ' with ' + bridge.prospectGets + ', but it requires coordination. The challenge: they\'re not sitting around thinking "I wish someone would handle this for me"—you need to demonstrate that outsourcing this to you is better than doing it in-house or ignoring it. Your goal of ' + goal.toLowerCase() + ' only makes sense if it measurably improves their operations. Run the numbers with them: if coordinating with you saves them 10 hours/week or delivers 20% more customers, it\'s worth it. If it\'s marginal, they\'ll pass.';
            } else {
                return 'The bridge exists but needs reinforcement. ' + anchorData.name + ' brings ' + bridge.anchorProvides + ' that theoretically helps ' + prospectData.name + ' achieve ' + bridge.prospectGets + ', but the value isn\'t obvious yet. Your job: make it obvious fast. Pilot program: pick their highest-value customer segment and demonstrate clear ROI in 30-60 days. Frame it as: "You want more [their desired outcome], I deliver it reliably, you pay based on results." If you can\'t articulate why this makes their life measurably better, the partnership stalls. Your goal of ' + goal.toLowerCase() + ' is the consequence of becoming their trusted solution, not the reason they partner with you.';
            }
        } else {
            return 'Honest assessment: the bridge is weak. ' + anchorData.name + '\'s ' + bridge.anchorProvides + ' doesn\'t clearly solve a burning problem for ' + prospectData.name + '. They\'re not desperate for ' + bridge.prospectGets + ', and you\'re asking them to invest time in something that feels peripheral to their core business. Your goal of ' + goal.toLowerCase() + ' requires them to care about your success, which they don\'t—yet. If you pursue this, keep it ultra-minimal: a single test campaign or informal referral arrangement with a 30-day evaluation. If there\'s no mutual excitement after 30 days, walk away. Forcing partnerships that lack natural fit burns goodwill and wastes time.';
        }
    }
    
    function identifyPartnershipBridge(anchorData, prospectData, goal) {
        // The bridge is what the anchor provides that solves the prospect's problem
        const anchorInfo = anchorData.info.toLowerCase();
        const prospectInfo = prospectData.info.toLowerCase();
        const goalLower = goal.toLowerCase();
        
        let bridge = {
            anchorProvides: '',
            prospectGets: '',
            prospectProvides: '',
            anchorGets: ''
        };
        
        // Transportation/Logistics bridge
        if (anchorInfo.includes('transportation') || anchorInfo.includes('bus') || anchorInfo.includes('shuttle')) {
            bridge.anchorProvides = 'reliable transportation infrastructure';
            bridge.prospectGets = 'increased customer accessibility, reduced parking burden, and expanded market reach';
            bridge.prospectProvides = 'destination access and customer referrals';
            bridge.anchorGets = 'ridership volume and route utilization';
        }
        // Marketing/Audience bridge
        else if (anchorInfo.includes('marketing') || anchorInfo.includes('media') || anchorInfo.includes('audience')) {
            bridge.anchorProvides = 'audience access and marketing reach';
            bridge.prospectGets = 'brand visibility and customer acquisition';
            bridge.prospectProvides = 'content and credibility';
            bridge.anchorGets = 'content inventory and engagement metrics';
        }
        // Technology/Platform bridge
        else if (anchorInfo.includes('software') || anchorInfo.includes('platform') || anchorInfo.includes('technology')) {
            bridge.anchorProvides = 'technical capabilities and infrastructure';
            bridge.prospectGets = 'operational efficiency and scale';
            bridge.prospectProvides = 'use case validation and feedback';
            bridge.anchorGets = 'platform adoption and recurring revenue';
        }
        // Services/Expertise bridge
        else if (anchorInfo.includes('consulting') || anchorInfo.includes('services') || anchorInfo.includes('agency')) {
            bridge.anchorProvides = 'specialized expertise and execution capacity';
            bridge.prospectGets = 'capability extension without overhead';
            bridge.prospectProvides = 'project scope and market access';
            bridge.anchorGets = 'billable engagements and portfolio expansion';
        }
        // Default/Generic bridge
        else {
            bridge.anchorProvides = 'complementary capabilities';
            bridge.prospectGets = 'expanded service offering';
            bridge.prospectProvides = 'customer access';
            bridge.anchorGets = 'market presence and revenue';
        }
        
        return bridge;
    }
    
    function identifyPartnershipLever(anchorData, prospectData, goal) {
        const combined = (anchorData.info + ' ' + prospectData.info + ' ' + goal).toLowerCase();
        
        // Marketing/Awareness indicators
        const marketingScore = 
            (combined.includes('social') ? 2 : 0) +
            (combined.includes('marketing') ? 2 : 0) +
            (combined.includes('awareness') ? 2 : 0) +
            (combined.includes('brand') ? 1 : 0) +
            (combined.includes('traffic') ? 1 : 0) +
            (combined.includes('seo') ? 1 : 0);
        
        // Operational indicators
        const operationalScore = 
            (combined.includes('logistics') ? 2 : 0) +
            (combined.includes('transportation') ? 2 : 0) +
            (combined.includes('schedule') ? 2 : 0) +
            (combined.includes('booking') ? 1 : 0) +
            (combined.includes('integration') ? 1 : 0) +
            (combined.includes('operational') ? 1 : 0);
        
        // Strategic/Referral indicators
        const strategicScore = 
            (combined.includes('referral') ? 2 : 0) +
            (combined.includes('revenue') ? 1 : 0) +
            (combined.includes('commission') ? 2 : 0) +
            (combined.includes('incentive') ? 1 : 0) +
            (combined.includes('growth') ? 1 : 0);
        
        // Return highest scoring lever
        if (operationalScore > marketingScore && operationalScore > strategicScore) {
            return 'operational';
        } else if (marketingScore > strategicScore) {
            return 'marketing';
        } else {
            return 'strategic';
        }
    }

    function generateFriction(anchorData, prospectData, matchScore) {
        const lever = identifyPartnershipLever(anchorData, prospectData, userGoal);
        
        if (matchScore >= 80) {
            if (lever === 'marketing') {
                return 'Main friction: getting on their radar and staying there. Their marketing team is juggling 10 priorities—is promoting you one of them? Reality check questions: (1) Is their traffic concentrated on pages where your link would naturally fit? (2) Do they actually post consistently on social, or is their Instagram dead? (3) Who at ' + prospectData.name + ' owns partnerships, and are they responsive? Biggest risk isn\'t technical—it\'s that you get the deal done, they put up a link buried on page 3, and nobody clicks it.';
            } else if (lever === 'operational') {
                return 'Operational friction comes down to: (1) Timing—are your peak hours when they can actually deliver? If you need buses at 7am on weekends and they don\'t run until 9am, the partnership is dead on arrival. (2) Handoff complexity—every extra step in the customer journey kills conversion. (3) Staff buy-in—their frontline team needs to understand and promote this, or it won\'t happen. Don\'t underestimate the "last mile" problem: the deal can look great on paper but fail because someone\'s staff wasn\'t trained or the process was too clunky.';
            } else {
                return 'Incentive alignment is everything. If they make $5 per referral but it takes them 30 minutes to explain your offering, they won\'t do it. Friction points: (1) Is the commission structure simple and worth their time? (2) Can they track referrals easily, or is it a black box? (3) Do they actually have leverage over their customers\' decisions, or are they just hoping people click a link? Also: relationship dependency. If your main contact at ' + prospectData.name + ' leaves, does the partnership die? That\'s a red flag.';
            }
        } else if (matchScore >= 60) {
            if (lever === 'marketing') {
                return 'Getting mindshare will be tough. Their audience kinda overlaps with yours, but not perfectly—which means your messaging needs to work harder. Friction: (1) You might need to create custom content just for their audience, which takes time. (2) Their brand might not want to be too closely associated with yours (brand alignment issues). (3) You\'re probably not their top partnership priority, so expect slow responses and delayed launches. Set realistic expectations: this might take 3 months to get live when you wanted 3 weeks.';
            } else if (lever === 'operational') {
                return 'You\'re trying to coordinate operations between two companies that probably have different systems, schedules, and priorities. Friction points: (1) Technical compatibility—even "simple" integrations require dev work and testing. (2) Process alignment—their booking flow might not accommodate your offering easily. (3) Support burden—when something breaks, who fixes it? Be clear upfront about ongoing maintenance, or this becomes a "launched once, broke twice, abandoned forever" situation.';
            } else {
                return 'The incentives don\'t naturally align, so you\'re manufacturing a partnership that requires active management. Risks: (1) They agree to promote you but never actually do it because other priorities take over. (2) The referral quality is low—they send you tire-kickers who don\'t convert. (3) Tracking disputes—they claim they sent 100 customers, you only see 30 conversions, and now you\'re arguing about attribution. Consider: is the potential upside worth the ongoing headache of managing this relationship?';
            }
        } else {
            return 'Let\'s be real: the friction here is that this partnership probably shouldn\'t happen. You\'re forcing a fit that isn\'t natural. Practical concerns: (1) You\'ll spend weeks negotiating something that might drive 10 customers. (2) Their team doesn\'t understand your value prop, so they can\'t sell it effectively. (3) Every communication will require over-explaining context because the overlap isn\'t obvious. Cut your losses: if you can\'t articulate why this partnership makes them more money or serves their customers better in one sentence, it\'s not worth pursuing.';
        }
    }

    function generateVettingQuestions(anchorData, prospectData, goal, matchScore) {
        const lever = identifyPartnershipLever(anchorData, prospectData, goal);
        const bridge = identifyPartnershipBridge(anchorData, prospectData, goal);
        const questions = [];
        
        // Question 1: Always about what THEY care about
        if (matchScore >= 70) {
            questions.push('What\'s your biggest operational challenge right now when it comes to ' + bridge.prospectGets + '? (I\'m trying to understand if what ' + anchorData.name + ' solves is actually a priority for you, or if we\'re solving a problem you don\'t have.)');
        } else {
            questions.push('Walk me through your current approach to ' + bridge.prospectGets + '. What\'s working well, and where are the gaps? (I need to know if partnering with ' + anchorData.name + ' actually fills a meaningful gap or if it\'s a nice-to-have.)');
        }
        
        // Question 2: The elephant in the room - delegating control
        if (lever === 'operational') {
            questions.push('What\'s your biggest concern about delegating part of the customer journey—specifically ' + bridge.anchorProvides + '—to an outside partner like ' + anchorData.name + '? (Let\'s address the control, quality, and reliability concerns upfront rather than having them derail us later.)');
        } else if (lever === 'marketing') {
            questions.push('What\'s your biggest hesitation about promoting ' + anchorData.name + ' to your customers? Brand alignment, audience relevance, or something else? (I want to make sure we\'re not asking you to vouch for something your customers won\'t value.)');
        } else {
            questions.push('What would make you confident that referring customers to ' + anchorData.name + ' actually improves their experience rather than adding friction? (I need to understand your quality bar and whether we can meet it consistently.)');
        }
        
        // Question 3: Proof points from their perspective
        questions.push('If this partnership works, what does success look like from your perspective—not in terms of ' + anchorData.name + '\'s goals, but in terms of the measurable impact on your business? (I want to make sure we\'re tracking metrics that actually matter to you, not vanity metrics.)');
        
        return questions;
    }

    function displayAnalysisModal(analysis) {
        document.getElementById('modalCompanyName').textContent = prospectData.name;
        document.getElementById('modalCompanyUrl').textContent = prospectData.url.replace('https://', '').replace('http://', '');
        document.getElementById('modalMatchScore').textContent = analysis.matchScore + '%';
        document.getElementById('contextStatement').textContent = analysis.context;
        document.getElementById('modalSynergy').textContent = analysis.synergy;
        document.getElementById('modalFriction').textContent = analysis.friction;
        
        const questionsContainer = document.getElementById('modalQuestions');
        questionsContainer.innerHTML = analysis.questions.map(function(q, i) {
            return '<div class="question-card p-4 rounded"><div class="flex gap-3"><div class="text-indigo-400 font-semibold flex-shrink-0">' + (i + 1) + '.</div><p class="text-sm text-gray-300">' + q + '</p></div></div>';
        }).join('');
        
        hideProgress();
        document.getElementById('analysisModal').classList.remove('hidden');
        document.body.style.overflow = 'hidden';
    }

    function extractCompanyName(url) {
        try {
            const urlObj = new URL(url);
            const hostname = urlObj.hostname.replace('www.', '');
            const parts = hostname.split('.');
            return parts[0].charAt(0).toUpperCase() + parts[0].slice(1);
        } catch (e) {
            return 'Company';
        }
    }

    async function searchTavily(query) {
        const apiKey = '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';
        
        try {
            const response = await fetch('https://api.tavily.com/search', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    api_key: apiKey,
                    query: query,
                    search_depth: 'advanced',
                    max_results: 5,
                    include_answer: true
                })
            });
            
            if (!response.ok) throw new Error('API request failed');
            return await response.json();
        } catch (error) {
            console.error('Search error:', error);
            return {
                answer: 'Company focused on business innovation and growth.',
                results: [{ title: 'Overview', content: 'Business services company.', url: 'https://example.com' }]
            };
        }
    }

    function showProgress() {
        document.getElementById('initialInput').classList.add('hidden');
        document.getElementById('clarificationSection').classList.add('hidden');
        document.getElementById('progressSection').classList.remove('hidden');
    }

    function hideProgress() {
        document.getElementById('progressSection').classList.add('hidden');
    }

    function updateProgress(mainText, subText) {
        document.getElementById('progressText').textContent = mainText;
        document.getElementById('progressSubtext').textContent = subText || '';
    }

    function resetToInitialState() {
        hideProgress();
        document.getElementById('clarificationSection').classList.add('hidden');
        document.getElementById('initialInput').classList.remove('hidden');
    }

    function closeModal() {
        document.getElementById('analysisModal').classList.add('hidden');
        document.body.style.overflow = 'auto';
        resetToInitialState();
    }

    function cancelClarification() {
        resetToInitialState();
    }

    function sleep(ms) {
        return new Promise(function(resolve) { setTimeout(resolve, ms); });
    }

    // Initialize
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }
    
    function init() {
        const analyzeBtn = document.getElementById('analyzeBtn');
        const continueBtn = document.getElementById('continueBtn');
        const cancelBtn = document.getElementById('cancelBtn');
        const closeModalBtn = document.getElementById('closeModalBtn');
        
        if (analyzeBtn) {
            analyzeBtn.addEventListener('click', function(e) {
                e.preventDefault();
                analyzePartnership();
            });
        }
        
        if (continueBtn) {
            continueBtn.addEventListener('click', function(e) {
                e.preventDefault();
                continueAnalysis();
            });
        }
        
        if (cancelBtn) {
            cancelBtn.addEventListener('click', function(e) {
                e.preventDefault();
                cancelClarification();
            });
        }
        
        if (closeModalBtn) {
            closeModalBtn.addEventListener('click', function(e) {
                e.preventDefault();
                closeModal();
            });
        }
        
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') closeModal();
        });
    }
})();
    </script>
</body>
</html>
